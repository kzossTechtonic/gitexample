/*global AppleAccountSetup*/
/*jslint evil:true*/


/*
  if InternetAccount is defined, assign it to AppleAccountSetup.
  else if AppleAccountSetup is defined use it as is (do nothing)
  if neither InternetAccount nor AppleAccountSetup is defined, define
  AppleAccountSetup (dev mode)
*/

if (window.InternetAccount === undefined) {
  if (window.AppleAccountSetup === undefined) {
    $(function () { $("#navigation-bar").show(); });
    window.AppleAccountSetup = function() {
        var prevPage;
        var nextPage;

        return {
            getPrevPage: function() {
              return prevPage;
            },
            getNextPage: function() {
              return nextPage;
            },
            cancel: function() {
              alert("Account Setup cancelled.");
            },
            register : function(appleId, password) {
            },
            register_1c : function(appleId, password) {
            },
            register_1b: function(appleId, password) {
                //alert("Your account has been created !!!");
    var plist =
    'MIAGCSqGSIb3DQEHAqCAMIACAQExCzAJBgUrDgMCGgUAMIAGCSqGSIb3DQEHAaCA\
    JIAEggLwPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPCFE\
    T0NUWVBFIHBsaXN0IFBVQkxJQyAiLS8vQXBwbGUvL0RURCBQTElTVCAxLjAvL0VO\
    IiAiaHR0cDovL3d3dy5hcHBsZS5jb20vRFREcy9Qcm9wZXJ0eUxpc3QtMS4wLmR0\
    ZCI+CjxwbGlzdCB2ZXJzaW9uPSIxLjAiPgo8ZGljdD4KCTxrZXk+ZGV2aWNlSW5m\
    bzwva2V5PgoJPGRpY3Q+CgkJPGtleT5oYXJkd2FyZU1vZGVsPC9rZXk+CgkJPHN0\
    cmluZz5pUGhvbmUzLDE8L3N0cmluZz4KCQk8a2V5Pm1vYmlsZW1lLXNldHVwLXRv\
    a2VuPC9rZXk+CgkJPHN0cmluZz44MzA1NWE5ZjkxMDk5ZjUzZWRkMGE2NDRmZmYx\
    NzNmN2U4MzdmMTI5PC9zdHJpbmc+CgkJPGtleT5vc1ZlcnNpb248L2tleT4KCQk8\
    c3RyaW5nPjQuMjwvc3RyaW5nPgoJCTxrZXk+c2VyaWFsTnVtYmVyPC9rZXk+CgkJ\
    PHN0cmluZz44ODAxNDBDUEZSWDwvc3RyaW5nPgoJCTxrZXk+dWRpZDwva2V5PgoJ\
    CTxzdHJpbmc+OTVmYzY2NjBkYjE1NTJlZDdiZWQ3OWNjMTUyMDk3YTYxYmQxMjcy\
    NTwvc3RyaW5nPgoJPC9kaWN0PgoJPGtleT5wcm90b2NvbFZlcnNpb248L2tleT4K\
    CTxzdHJpbmc+MS4wPC9zdHJpbmc+Cgk8a2V5PnVzZXJJbmZvPC9rZXk+Cgk8ZGlj\
    dD4KCQk8a2V5Pmxhbmd1YWdlPC9rZXk+CgkJPHN0cmluZz5lbjwvc3RyaW5nPgoJ\
    CTxrZXk+dGltZXpvbmU8L2tleT4KCQk8c3RyaW5nPkFtZXJpY2EvTG9zX0FuZ2Vs\
    ZXM8L3N0cmluZz4KCTwvZGljdD4KPC9kaWN0Pgo8L3BsaXN0PgoAAAAAAACgggLl\
    MIIC4TCCAkqgAwIBAgIKBFt2+9O2laG2jzANBgkqhkiG9w0BAQUFADBaMQswCQYD\
    VQQGEwJVUzETMBEGA1UEChMKQXBwbGUgSW5jLjEVMBMGA1UECxMMQXBwbGUgaVBo\
    b25lMR8wHQYDVQQDExZBcHBsZSBpUGhvbmUgRGV2aWNlIENBMB4XDTEwMDgyNzE2\
    NTAzNFoXDTEzMDgyNzE2NTAzNFowgYMxLTArBgNVBAMTJDZENjc2RDU1LTVDNjYt\
    NEM1NC1BNTA1LUE4NjAwN0M5MjFCMjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNB\
    MRIwEAYDVQQHEwlDdXBlcnRpbm8xEzARBgNVBAoTCkFwcGxlIEluYy4xDzANBgNV\
    BAsTBmlQaG9uZTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAqZlocL4SaF4D\
    KJXH1q4usQUgefHYQkBxfX1m4xuqEnt/zqj97g08XRK2BQiWj8DNtRCkKpdNQ6rm\
    ITuIfAhDyYtTpG6BKxSHBAUpWDApVIAgUdeHdiTIm7qJjvvIfTBrj61/NhTmHTHE\
    GyVryFypFiwNF8EHkYmrcTUGHfPl9AkCAwEAAaOBgzCBgDAfBgNVHSMEGDAWgBSy\
    /iEjRIaVannVgSaOcxDYp0yOdDAdBgNVHQ4EFgQUQmh57PmBe/Mv2K0Y5lskJZLV\
    IuowDAYDVR0TAQH/BAIwADAOBgNVHQ8BAf8EBAMCBaAwIAYDVR0lAQH/BBYwFAYI\
    KwYBBQUHAwEGCCsGAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4GBAD/ouAcIMTe2KTf5\
    2tB2zi+ERNuYRBD7XDNgTtUg2frx+YN0+kRkTK5WjSzxM3ZOGk8ppLJFsNuymdUV\
    cnKjNJAAA469pVQXzGGaZZgy0U68UaX9btX60O767XPIMO82HES4BXPc5cF7uYrl\
    c6t0FZnQMAvZwFBC0pzJj+5EEiT9MYIBbTCCAWkCAQEwaDBaMQswCQYDVQQGEwJV\
    UzETMBEGA1UEChMKQXBwbGUgSW5jLjEVMBMGA1UECxMMQXBwbGUgaVBob25lMR8w\
    HQYDVQQDExZBcHBsZSBpUGhvbmUgRGV2aWNlIENBAgoEW3b707aVobaPMAkGBSsO\
    AwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEP\
    Fw0xMDA5MDEwNDAzMDhaMCMGCSqGSIb3DQEJBDEWBBQZR2jOdETSm0bv1aQ4sUd8\
    TkYR7DANBgkqhkiG9w0BAQEFAASBgFjn1kF6075tgMUP8ehMRadXRv8Mez9IVthk\
    leprXvjZHo6wsLKb6jieQGki6x2Es0JHCVO9tP1qNfFBYBoGz28U+oKTs5+SybUr\
    PmHrObE237P1vktVjw54Z7y9twsAV/nkhkfoORqePOzA9QZe4slvdMglr64UdDHY\
    nx4pOeKLAAAAAAAA';
    			// post to the server
    			var udid = "sdfsdfsdfdsF";
    			$.ajax(
                {
                        type: "POST",
                        data: plist,
                        url: "/setup/register/" + appleId + "/" + udid,
                        beforeSend: function(xhr) {
                            var auth = $.base64.encode(appleId + ":" + password);
                            xhr.setRequestHeader("Authorization", " Basic " + auth);
                        },
                        success: function(data, textStatus, xhr) {
                            // create the query string
                            // to post to the server
                            // using the device info
                            alert("success on register ...!!");
                        },
                        error: function(xhr, textStatus, errorThrown) {
                            //hide the spinner
                            alert("error on register : " + xhr.status);
                        }
                });

            },
            setNavTitle: function(title) {
                $("#navbartitle").html(title);
            },
            setLeftNavButton: function(title, callback) {
                $(".prev").attr("value", title);
                $('.prev').unbind('click');
                prevPage = callback;
                if(callback !== null) {
                    $('.prev').show();
                    $('.prev').bind('click',
                        function() {
                            eval(AppleAccountSetup.getPrevPage());
                        }
                    );
                }
                else {
                    $('.prev').hide();
                }
            },
            setRightNavButton: function(title, callback) {
                $(".next").attr("value", title);
                $('.next').unbind('click');
                nextPage = callback || "mmesetupui.nextPage()";
                $('.next').show();
                $('.next').bind('click',
                        function() {
                            eval(AppleAccountSetup.getNextPage());
                        }
                    );
            },
            confirmWithCallback: function(message, title, okTitle, cancelTitle, callback) {
              var flag = confirm(message + " : " + title);
              if (callback) {
                if(flag) {
                  callback(1);
                }
                else {
                  callback(0);
                }
              }
            },
            updateSucceeded : function() {
              alert("Update succeeded");
            },
            accountCreateCompleted : function(appleId, password, data) {
              alert("account create completed");
            },

            //Both "filename" and "contentblob" are strings
            saveTOS: function(filename, contentblob){
              console.log(filename,':',contentblob);
            },

            dismiss: function(exitTo){
              alert('exiting to: ' + exitTo);
            }

            } ;
    }();
  }
} else {
  window.AppleAccountSetup = window.InternetAccount ;
}

window.DevAutocomplete = function() {
  return {
    init : function() {
      $("#monthSelector").val(mmedevconstants.devBirthMonth).removeClass("defaulted").blur();
      $("#daySelector").val(mmedevconstants.devBirthDay).removeClass("defaulted").blur();
      $("#yearSelector").val(mmedevconstants.devBirthYear).removeClass("defaulted").blur();
      $("#countrySelector").val(mmedevconstants.devCountry).removeClass("defaulted").blur();

      $("#emailField").val(mmedevconstants.devEmail).removeClass("defaulted").blur();
      $("#firstNameField").val(mmedevconstants.devFirstName).removeClass("defaulted").blur();
      $("#lastNameField").val(mmedevconstants.devLastName).removeClass("defaulted").blur();
      $("#passwordField").val(mmedevconstants.devPassword).removeClass("defaulted").blur();
      $("#passwordField")[0].type = "password";
      $("#verifyPasswordField").val(mmedevconstants.devPassword).removeClass("defaulted").blur();
      $("#verifyPasswordField")[0].type = "password";
      $("#tosEmailField").val(mmedevconstants.devTOSEmail);

	}
};

  }();
