window.Keytrap=function(){"use strict";function e(e){var t=[e.keyCode||e.which];return e.shiftKey&&16!==e.keyCode&&t.push(16),e.ctrlKey&&17!==e.keyCode&&t.push(17),e.altKey&&18!==e.keyCode&&t.push(18),e.metaKey&&91!==e.keyCode&&t.push(91),t.sort(),t.join("+")}function t(e){return c[e]?c[e]:e.toUpperCase().charCodeAt(0)}function o(e){for(var o=e.split("+"),n=[],i=0;i<o.length;i++)n.push(t(o[i]));return n.sort(),n.join("+")}function n(e){for(var t=[],n=e.split(","),i=0;i<n.length;i++)t.push(o(n[i]));return t}function i(e,t){if(a[t]){for(var o=a[t],n=0;n<o.length;n++)o[n](e);if(s[t]&&e)return jQuery.Event(e).stopPropagation(),!1}}function l(t){return i(t,e(t))}var a={},s={},c={backspace:8,tab:9,enter:13,"return":13,shift:16,ctrl:17,comctrl:17,alt:18,"":18,capslock:20,esc:27,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46,meta:91,command:91,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,'"':222};return-1!==navigator.appVersion.indexOf("Mac")&&(c.comctrl=91),$(document).on("keydown",l),{bind:function(e,t,o){for(var i=n(e),l=i.length-1;l>=0;l--)jQuery.isArray(a[i[l]])||(a[i[l]]=[]),a[i[l]].push(t),s[i[l]]=!!o},getKeyCode:function(e){return t(e)},getKeyEventID:function(t){return"string"==typeof t?o(t):e(t)},keyEventMatchesKeyCombo:function(t,n){return e(t)===o(n)},trigger:function(e,t){i(e,t)}}}();var Love={_saveLoveToDBFunc:null,THROTTLE_DELAY:500,init:function(){_.extend(this,AJAXUtil),this.user=window.__user,this._bindToDOM(),this._createSaveLoveToDBFunc()},_createSaveLoveToDBFunc:function(){this._saveLoveToDBFunc=_.throttle(this._saveLoveChange,this.THROTTLE_DELAY,{leading:!1,trailing:!0})},_bindToDOM:function(){$("body").on("click",'a[id*="loves_"], button[id*="loves_"], span[id*="loves_"]',$.proxy(this._onHeartClick,this))},_onHeartClick:function(e){if(e.preventDefault(),this._userNeedsToLogin())return this._redirectToLogin();var t=$(e.target).closest(".loves");this._heartItem(t)},_userNeedsToLogin:function(){return 1==this.user.id},_redirectToLogin:function(){window.location="/login?type=love"},_heartItem:function(e){var t=this._getNextLevel(e);this._showAsHearted(e,t),this._saveLoveToDBFunc(e.data("item"),e.data("hashid"),t)},_getNextLevel:function(e){if(e.hasClass("comment-heart"))return this._isCommentedLoved(e)?0:1;var t=this._findTextLoveLevel(e.attr("class"));return this._nextLoveLevel(t)},_isCommentedLoved:function(e){return e.hasClass("love")},_findTextLoveLevel:function(e){var t=e.match(/loved-(\d)/);return t?1*t[1]:0},_nextLoveLevel:function(e){return 3===e?0:e+1},_showAsHearted:function(e,t){this._isHeartingComment(e)?this._showCommentHeartAsHearted(e,t):this._showStandardHeartAsHearted(e,t)},_isHeartingComment:function(e){return e.hasClass("comment-heart")},_showCommentHeartAsHearted:function(e,t){t>0?e.addClass("love loved-1"):e.removeClass("love loved-1"),this._updateLoveCount(e,t)},_showStandardHeartAsHearted:function(e,t){var o=e.data("hashid"),n=$("[data-hashid='"+o+"']");$.each(n,function(e,o){var n=$(o);if(!n.hasClass("count")){var i=n.hasClass("single-stat")?n:$(".heart-button");i.removeClass("loved-1 loved-2 loved-3 loved-0").attr("aria-pressed",!1).addClass("loved-"+t),0!=t&&i.attr("aria-pressed",!0),Love._updateLoveCount(i,t)}})},_updateLoveCount:function(e,t){var o=e.find("span.count"),n=this._getValueToAddToCount(t);o.html(this._getLoveCount(o,n))},_getValueToAddToCount:function(e){return 0===e?-1:1===e?1:0},_getLoveCount:function(e,t){var o=e.html();if(o){var n=1*o.replace(/[,. ]/g,""),i=isNaN(n)?0:n;return(i+=t)>0?this._delimit(i):""}return""},_delimit:function(e,t){return t=t||",",e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)},_saveLoveChange:function(e,t,o){var n="/love/"+[e,t,o].join("/");this.post(n,{},function(){this._doneSaveLoveChange(e)})},_doneSaveLoveChange:function(e){"undefined"!=typeof Hub&&Hub.pub(e+"-hearted")}};Love.init(),function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(o){function n(){!e&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;e=!0;var l=new this;for(var a in e=!1,o)l[a]="function"==typeof o[a]&&"function"==typeof i[a]&&t.test(o[a])?function(e,t){return function(){var o=this._super;this._super=i[e];var n=t.apply(this,arguments);return this._super=o,n}}(a,o[a]):o[a];return n.prototype=l,n.prototype.constructor=n,n.extend=arguments.callee,n}}(),function(){function e(e){AJAXUtil.get(t(e.grid_url),{},v)}function t(e){var t=e.split("?");return t.length>1?t[0]+"?"+t[1]+"&_cachebust="+(new Date).getTime():e+"?_cachebust="+(new Date).getTime()}function o(){k||(n(),k=!0)}function n(){i(),l(),d()}function i(){$("body").on("click","a.pagination-button",h)}function l(){Keytrap.bind("left",function(e){a(e,"prev")}),Keytrap.bind("right",function(e){a(e,"next")})}function a(e,t){var o=r();s(o,t)&&!c(e)&&f(o.grid_id,t)}function s(e,t){return!!e&&$("#"+e.grid_id).find(".pagination-button[data-direction='"+t+"']").length>0}function c(e){return _.include(["input","select","textarea"],e.target.tagName.toLowerCase())}function r(){return _.find(T,{page_is_main_grid:!0})}function d(){x.bind("popstate",u)}function u(e){e.originalEvent.state&&AJAXUtil.get(e.originalEvent.state,{},function(e){v(e,!1)})}function h(e){return e.preventDefault(),setTimeout(function(){var t=$(e.target).closest("a.pagination-button");f(t.data("grid-id"),t.data("direction"))},20),!1}function f(e,t){var o=p(e);AJAXUtil.get(o[t+"_grid_url"],{},v)}function p(e){return _.find(T,{grid_id:e})}function g(e){var t=m(e.grid_id);T[t]=e}function m(e){return _.findIndex(T,{grid_id:e})}function v(e,t){g(e.page),w(e.page),P(e.page,t),M(e)}function w(e){var t=$("#"+e.grid_id);t.html(e.html),C(e,t)}function C(e,t){if(e.page_is_main_grid&&!CP.Page.firstTimeLoading){var o=t.parent().offset().top;x.scrollTop()>o&&L.animate({scrollTop:o},b)}else CP.Page.firstTimeLoading=!1}function P(e,t){if(e.page_is_main_grid&&D(e,t)){var o=e.page_url,n=window.location.hash;y(e.page_url)?(window.history.replaceState(e.grid_url,"",o),setTimeout(function(){window.location.hash=n},50)):(A?(window.history.replaceState(e.grid_url,"",o),setTimeout(function(){window.location.hash=n},50)):(window.history.pushState(e.grid_url,"",o),setTimeout(function(){window.location.hash=n},50)),A=!1)}}function y(e){return"/"===e.replace(window.location.pathname,"")}function D(e,t){return t=void 0===t||t,window.history.pushState&&t}function M(e){Hub.pub("grid-changed",e)}CP.Page={firstTimeLoading:!0},window.Page=CP.Page;var T=[],b=300,x=$(window),L=$("html, body");CP.Page.renderPages=function(t){window._inIntegrationTest()||(o(),(T=t).forEach(e))};var k=!1,A=!0}(),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};var Copy={collectionUpdated:"Your collection '<%= name %>' was updated.",collectionDeleted:"Your collection '<%= name %>' was deleted.",collectionSaved:"'<%= name %>' collection saved. <a href='<%= url %>'>View collection</a>."},FollowingActions={init:function(){_.extend(this,AJAXUtil),this.user=__user,this.profiled=__profiled,this._bindToDOM()},_bindToDOM:function(){this.addOnHoverChangeToFollowButton(),$("#follow-this-user, #following-this-user")._on("click",this.followThisUser,this)},addOnHoverChangeToFollowButton:function(){$("#following-this-user").hover(function(){$(this).addClass("red").data("text-value",$(this).html()).html("<svg class='icon-x'><use xlink:href='#x'></use></svg> Following")},function(){$(this).removeClass("red").html($(this).data("text-value"))})},followThisUser:function(){this._userNeedsToLoginToFollow()?window.location="/login?type=follow#login-login":this._followProfiled()},_userNeedsToLoginToFollow:function(){return 1===this.user.id},_followProfiled:function(){var e=this._getActionTypeTaken();this._updateFollowButtonImmediately(),this.post(this._getFollowUnfollowURL(e),{},this._doneFollowThisUser)},_getActionTypeTaken:function(){return $("#follow-this-user").is(":visible")?"follow":"unfollow"},_updateFollowButtonImmediately:function(){$("#follow-this-user").is(":visible")?(this.updateFollowCount($("#followers-count"),1),$("#follow-this-user").hide(),$("#following-this-user").show()):(this.updateFollowCount($("#followers-count"),-1),$("#follow-this-user").show(),$("#following-this-user").hide())},_getFollowUnfollowURL:function(e){var t="/follow/<%= type %>/<%= username %>/<%= action %>";return _.template(t,{type:this.profiled.type,username:this.profiled.username,action:e})},_doneFollowThisUser:function(e){$("#followers-tab").hasClass("active")&&$("#followers").replaceWith(e.html)},updateFollowCount:function(e,t){e.html(this._getPrettifiedCount(e.html(),t))},_getPrettifiedCount:function(e,t){var o=1*(e||"").replace(",","")+t;return o>0?o.toLocaleString():0}};FollowingActions.init();var HireMeActions={init:function(){_.extend(this,AJAXUtil),this.profiled=__profiled,this._bindToDOM(),this._showHireMeAfterHireMeRedirect()},_bindToDOM:function(){$("#hire-me-button")._on("click",this._showHireMeModal,this)},_showHireMeAfterHireMeRedirect:function(){document.location.hash.match("hireme")&&this._showHireMeModal()},_showHireMeModal:function(){this.get("/hire_mes/new",{profiled_user_id:window.__profiled.id},this.doneShowHireMeModal,this.failedShowHireMeModal)},doneShowHireMeModal:function(e){$.showModal(e.html,"email-modal modal-email",$.proxy(this.bindToHireMeButtons,this))},bindToHireMeButtons:function(){this.bindToCloseButton(),$("#email-form")._on("submit",this.sendHireMeEmail,this)},sendHireMeEmail:function(){var e=$("#message").val();$("#provide-expl-error-msg").addClass("hide"),this._isValidWorkInquiry(e)?(this.post("/hire_mes",{message:e,profiled_user_id:window.__profiled.id},this.doneSendHireMeEmail),$.hideModal()):$("#provide-expl-error-msg").removeClass("hide")},MIN_WORK_MSG_LENGTH:15,_isValidWorkInquiry:function(e){return $.trim(e||"").length>this.MIN_WORK_MSG_LENGTH},doneSendHireMeEmail:function(){$.showMessage("Your work inquiry has been emailed!",5e3)},bindToCloseButton:function(){$("#cancel-button")._on("click",function(){$.hideModal()})},failedShowHireMeModal:function(e){"we_need_an_email"===e.type?$.showModal(e.html,"email-modal modal-email",$.proxy(this.bindToCloseButton,this)):"redirect"===e.type?window.location=e.url:this.showStandardErrorMessage(e)}};HireMeActions.init();var RememberGridLayout=Class.extend({init:function(){this._bindToDOM()},_bindToDOM:function(){$("body").on("click","#grid-view",$.proxy(this._onGridViewClick,this)).on("click","#list-view",$.proxy(this._onListViewClick,this))},_onGridViewClick:function(){this._setGridLayoutCookie("grid")},_onListViewClick:function(){this._setGridLayoutCookie("list")},_setGridLayoutCookie:function(e){$.cookie("grid_layout",e,{expires:30,domain:window._getCPWildcardDomain(),path:"/"})}});!function(){function e(){var e=$("#profile-header"),t=e.outerWidth(),o=e.outerHeight(),n=$(".profile-background-iframe");n.width(t),n.height(o)}function t(){e(),$(document.body).bind("scollapse",function(){e()}),$(window).resize(_.debounce(function(){e()},500))}t()}(),function(){function e(){$("body").on("change",".collection-choice",t)}function t(e){var t=n(e);-1===[c,r].indexOf(t)&&s(t,i(e))}function o(e){$.showMessage(a(e),"slow"),$(".collections-mini-modal").remove(),u.val(r)}function n(e){return $(e.target).find("option:selected").val()}function i(e){return"pen"===d?CP.pen.slug_hash:$(e.target).closest(".single-pen").data("slug-hash")}function l(e,t){return"/collections/add/"+e+"/"+t}function a(e){var t=e.collection.slug_hash;return e.collection["private"]&&(t=e.collection.slug_hash_private),_.template(Copy.penAddToCollection,{name:e.collection.name,url:"/collection/"+t})}function s(e,t){AJAXUtil.post(l(e,t),{},o)}CP.collectionAddPen={};var c="__add__",r="__choose__",d=window.__pageType,u=$("#collection-choice");CP.collectionAddPen.init=function(){e()}}(),"undefined"==typeof window.Copy&&(window.Copy={}),_.extend(window.Copy,{penRemovedFromCollection:"Pen removed from Collection.",collectionSavedPenAdded:"Your Collection '<%= name %>' was created and this Pen was added to it. <a href='<%= url %>'>View collection</a>.",collectionCreated:"Your Collection '<%= name %>' was created. <a href='<%= url %>'>View collection</a>.",collectionUpdated:"Your Collection '<%= name %>' has been updated.",penAddToCollection:"This Pen was added to the '<%= name %>' collection. <a href='<%= url %>'>View collection</a>.",collectionDeleted:"Your Collection was deleted!"});var CollectionRemovePen=Class.extend({init:function(){_.extend(this,AJAXUtil),this._bindToDOM()},_bindToDOM:function(){$("body").on("click",".remove-pen-from-collection",$.proxy(this._removePenFromCollection,this))},_removePenFromCollection:function(e){this.post(this._getRemovePenFromCollectionURL($(e.target)),{},$.proxy(this._onDoneRemovePenFromCollection,this))},_getRemovePenFromCollectionURL:function(e){return"/collections/remove/"+window.__item.slug_hash+"/"+e.data("slug-hash")},_onDoneRemovePenFromCollection:function(){Page.renderPages(window.__pages)}}),CollectionsFlyout=Class.extend({init:function(){this._bindToDOM(),this._bindToHub()},_bindToDOM:function(){$("body").on("click",".add-to-collection-from-flyout",$.proxy(this._show,this)).on("click",".close-button-collections-mini-modal",$.proxy(this._close,this))},_bindToHub:function(){Hub.sub("collection-saved",this._close)},_show:function(e){e.preventDefault(),$.get("/ajax/collections/flyout_mini_modal",function(t){$(e.target).closest(".single-pen").append(t.html)})},_close:function(){$(".collections-mini-modal").remove()}});!function(){function e(e,t){AJAXUtil.put("/collections/"+e.slug_hash,e,t)}function t(e,t){AJAXUtil.post("/collections",e,t)}function o(e){return _.extend(e,{slug_hash:CP.collection.selectedPenSlugHash})}function n(){s({"private":u()})}function i(){e(CP.collection.VM,function(){d()})}function l(){return{id:"",name:"",description:"",slug_hash:"",slug_hash_private:"","private":!1}}function a(){for(var e in CP.collection.VM=l(),CP.collection._VM=[],CP.collection.VM)CP.collection._VM.push(e)}function s(e){for(var t in e)-1!==CP.collection._VM.indexOf(t)&&(CP.collection.VM[t]=e[t])}function c(){s(window.__item)}function r(){var e=CP.collection.VM;return e["private"]?e.slug_hash_private:e.slug_hash}function d(){if(window.history.replaceState&&r()){var e=URLBuilder.getViewURLSimple("collection","",r(),!1);window.history.replaceState(e,"",e)}}function u(){return!!$("#collection-details-private").is(":checked")}CP.collection={},CP.collection.init=function(){a(),c()},CP.collection.updateViewModel=function(e){s(e)},CP.collection.getActiveSlugHash=r,CP.collection.onPrivacyChange=n,CP.collection.onEditPrivacyChange=i,CP.collection.loadBlankViewModel=a,CP.collection.loadInitialViewModel=c,CP.collection.selectedPenSlugHash="",CP.collection.save=function(n){CP.collection.VM.slug_hash.length>0?e(CP.collection.VM,n):t(o(CP.collection.VM),n)}}(),function(){function e(e,t){CP.TextFormatter.put("/text_formatter/text",{text:e},t)}CP.TextFormatter={},CP.TextFormatter.init=function(){_.extend(CP.TextFormatter,AJAXUtil),CP.TextFormatter.formatText=e}}(),function(){function e(){O.on("click",".edit-collection",n).on("click","#add-new-collection-button",o).on("click","#create-new-collection",o).on("change",".collection-choice",t).on("submit","#edit-collection-form",s).on("submit","#add-new-collection-form",s).on("click","#add-new-collection-form .ios-toggle",l).on("click","#edit-collection-form .ios-toggle",a),U.on("click",m)}function t(e){v(e)===R&&(A=!0,i(w(e)))}function o(e){e.preventDefault(),i("")}function n(e){k=!0,H=!0,e.preventDefault(),y($(e.target).data("slug-hash"),"")}function i(e){k=!1,H=!1,CP.collection.loadBlankViewModel(),y(0,e)}function l(){CP.collection.onPrivacyChange()}function a(){l(),CP.collection.onEditPrivacyChange(),b()}function s(e){e.preventDefault(),d()}function c(e){e.success?(p(e),g()):AJAXUtil.showStandardErrorMessage(e)}function r(e,t){CP.collection.updateViewModel(t),D(e,t),M(t),Hub.pub("collection-saved")}function d(){C(),CP.collection.save(function(e){r(CP.collection.VM.id,e.collection)})}function u(){Hub.sub("key",h),Hub.sub("popup-open",f)}function h(e,t){"esc"===t.key&&m()}function f(e,t){t!==I&&m()}function p(e){(L=$("<div />",{"class":"modal modal-neutral group ",html:e.html})).appendTo(O)}function g(){CP.showPopupOverlay(),L.find("#name").focus(),B=!0,L.find(".close-button").on("click",m),Hub.pub("popup-open",I),CP.HelpFlyouts.init()}function m(e){e&&e.preventDefault(),B&&(CP.hidePopupOverlay(),L.remove(),B=!1)}function v(e){return $(e.target).find("option:selected").val()}function w(e){return"pen"===N?CP.pen.slug_hash:$(e.target).closest(".single-pen").data("slug-hash")}function C(){var e=$(".collection-settings-form").serializeObject();CP.collection.updateViewModel(e)}function P(e,t){var o=Copy.collectionUpdated;return H||(o=A?Copy.collectionSavedPenAdded:Copy.collectionCreated),_.template(o,{originalId:e,name:t.name,url:"/collection/"+CP.collection.getActiveSlugHash()})}function y(e,t){var o;CP.collection.selectedPenSlugHash=t,o=e?"/collections/"+e+"/edit?slug_hash="+t:"/collections/new",$.ajax({url:o,success:c})}function D(e,t){$.showMessage(P(e,t),"slow")}function M(e){m(),k&&(F.html(e.name),CP.TextFormatter.formatText(e.description,function(e){j.html(e.text),x()})),T(e)}function T(e){(!0===e["private"]?S:E).append($("<option></option>").attr("value",e.slug_hash).text(e.name)),V.val("__choose__")}function b(){var e=j.find(".private-icon");e.length?e.toggle():x()}function x(){CP.collection.VM["private"]&&j.prepend("<span class='private-icon left'><svg class='icon-lock'><use xlink:href='#lock'></use></svg></span>")}CP.createEditCollection={};var L,k,A,H,O=$("body"),U=$("#popup-overlay"),S=$(".collection-options-public"),E=$(".collection-options-private"),F=$("#collection-name"),j=$("#collection-desc"),V=$(".collection-choice"),R="__add__",I="createEditCollection",B=!1,N=window.__pageType;CP.createEditCollection.init=function(){CP.collection.init(),CP.TextFormatter.init(),e(),u()}}();var DeleteCollection=Class.extend({init:function(){_.extend(this,AJAXUtil),this._bindToDOM()},_bindToDOM:function(){$("body").on("click",".delete-collection",$.proxy(this._onDeleteCollection,this)).on("click",".delete-collection-from-grid",$.proxy(this._onDeleteCollection,this)).on("click","#confirm-delete[data-item='collection']",$.proxy(this._deleteConfirmed,this))},_onDeleteCollection:function(e){e.preventDefault(),$.showModal("/ajax/collections/confirm_collection_delete"+this._getParams(e),"modal-warning")},_getParams:function(e){return"?collection_slug_hash="+$(e.target).data("slug-hash")+"&pagetype="+$(e.target).data("pagetype")},_deleteConfirmed:function(e){e.preventDefault(),this.del(this._getDeleteURL(e),{},this._getOnDoneFunc(e))},_getDeleteURL:function(e){return"/collections/"+$(e.target).data("slug-hash")},_getOnDoneFunc:function(e){return"grid"===$(e.target).data("pagetype")?this._doneDeleteCollectionOnGrid:this._doneDeleteCollection},_doneDeleteCollectionOnGrid:function(e){this._doneDeleteStandard(e),Hub.pub("collection-deleted",e)},_doneDeleteCollection:function(e){this._doneDeleteStandard(e),setTimeout(function(){window.location="/dashboard"},400)},_doneDeleteStandard:function(e){$.hideModal(),$.showMessage(this._getDoneDeleteCollectionMessage(e),"slow")},_getDoneDeleteCollectionMessage:function(e){return _.template(Copy.collectionDeleted,{name:e.collection.name})}}),PenDeleteOnOverlay=Class.extend({deletePenData:{},undoDeletePenTimeout:1e4,init:function(){_.extend(this,AJAXUtil),this._bindToDOM(),this._checkLocalStorage()},_checkLocalStorage:function(){CPLocalStorage.getItem("pen_deleted")&&(this.deletePenData=JSON.parse(CPLocalStorage.getItem("pen_deleted")),CPLocalStorage.removeItem("pen_deleted"),this._showRestoreDeletedPenMessage())},_bindToDOM:function(){$("body").on("click",".delete-pen",$.proxy(this._onDeletePen,this)).on("click","#restore-deleted-pen",$.proxy(this._undoDelete,this))},_onDeletePen:function(e){e.preventDefault(),this._deletePen($(e.target).data("id"),$(e.target).data("slug-hash"))},_deletePen:function(e,t){this.deletePenData.penID=e,this.deletePenData.activeSlugHash=t,this._showConfirmDeleteModal()},_showConfirmDeleteModal:function(){$.showModal("/ajax/confirm_pen_delete","modal-warning",$.proxy(this._deletePenModalCallback,this))},_deletePenModalCallback:function(){$("#confirm-delete")._on("click",this._deletePenConfirmed,this)},_deletePenConfirmed:function(){this._sendDeleteToServer(),this._removePenFromGrid(),this._showRestoreDeletedPenMessage()},_sendDeleteToServer:function(){this.del("/pen/"+this.deletePenData.activeSlugHash,{},this.doneDelete,this.failedDelete)},_removePenFromGrid:function(){$("#del-pen-"+this.deletePenData.penID).closest(".single-pen").slideUp("",function(){$(this).remove()})},_showRestoreDeletedPenMessage:function(){$.showMessage(_.template(this._restorePenMessage(),this.deletePenData),"super-slow")},_restorePenMessage:function(){return"Your pen was deleted. <a id='restore-deleted-pen' data-id='<%= penID %>' data-slug-hash='<%= activeSlugHash %>' href='#0'>Undo?</a>"},DONE_DELETE_TIMEOUT:500,doneDelete:function(){$.hideOverlay(),setTimeout(function(){Page.renderPages(window.__pages)},this.DONE_DELETE_TIMEOUT)},failedDelete:function(e){$.hideMessage(),this.showStandardErrorMessage(e)},_undoDelete:function(e){e.preventDefault(),$.showMessage("Recovering pen...",this.undoDeletePenTimeout),this.post(this._getUndoDeleteURL(e),{},this._doneUndoDelete)},_getUndoDeleteURL:function(e){return"/pen/restore/"+$(e.target).attr("data-slug-hash")},_doneUndoDelete:function(){$.hideMessage(),Page.renderPages(window.__pages)}}),ProjectDeleteOnOverlay=Class.extend({deleteProjectData:{},init:function(){_.extend(this,AJAXUtil),this._bindToDOM()},_bindToDOM:function(){$("body").on("click",".delete-project",$.proxy(this._onDeleteProject,this))},_onDeleteProject:function(e){e.preventDefault(),this._deleteProject($(e.target).data("id"),$(e.target).data("slug-hash"))},_deleteProject:function(e,t){this.deleteProjectData.id=e,this.deleteProjectData.hashid=t,this._showConfirmDeleteModal()},_showConfirmDeleteModal:function(){$.showModal("/ajax/confirm_project_delete","modal-warning",$.proxy(this._deleteProjectModalCallback,this))},_deleteProjectModalCallback:function(){$("#confirm-delete")._on("click",this._deleteProjectConfirmed,this)},_deleteProjectConfirmed:function(){"delete"===$("#confirm-delete-input").val()&&(this._sendDeleteToServer(),this._removeProjectFromGrid())},_sendDeleteToServer:function(){this.del("/projects/project/"+this.deleteProjectData.hashid,{},this.doneDelete,this.failedDelete)},_removeProjectFromGrid:function(){$("#del-project-"+this.deleteProjectData.id).closest(".single-project").slideUp("",function(){$(this).remove()})},DONE_DELETE_TIMEOUT:500,doneDelete:function(e){$.hideMessage(),$.hideOverlay(),e.payload.remaining_projects>0&&$(".new-project-button.upsell").removeClass("upsell").removeAttr("data-url").off("click"),setTimeout(function(){Page.renderPages(window.__pages)},this.DONE_DELETE_TIMEOUT)},failedDelete:function(e){$.hideMessage(),this.showStandardErrorMessage(e)}}),RemoveAsTemplateOverlay=Class.extend({init:function(){_.extend(this,AJAXUtil),this._bindToDOM()},_bindToDOM:function(){$("body").on("click",".untemplate-pen",$.proxy(this._onUntemplatePen,this))},_onUntemplatePen:function(e){e.preventDefault(),this._untemplatePen($(e.target).data("hashid")),this._removePenFromPage($(e.target).data("hashid")),this._showMessage()},_untemplatePen:function(e){this.del("/templates/"+e,{item_type:"pen"},this._doneUntemplate)},_removePenFromPage:function(e){$("#untemplate-pen-"+e).closest(".single-pen").slideUp("",function(){$(this).remove()})},_showMessage:function(){$.showMessage(this._removedMessage(),"super-slow")},_removedMessage:function(){return"Your Pen was removed from your templates."},_doneUntemplate:function(){$.hideOverlay(),Page.renderPages(window.__pages)}});new CollectionsFlyout,CP.createEditCollection.init(),new DeleteCollection,CP.collectionAddPen.init(),new CollectionRemovePen,new PenDeleteOnOverlay,new ProjectDeleteOnOverlay,new RemoveAsTemplateOverlay,new RememberGridLayout,Page.renderPages(window.__pages);