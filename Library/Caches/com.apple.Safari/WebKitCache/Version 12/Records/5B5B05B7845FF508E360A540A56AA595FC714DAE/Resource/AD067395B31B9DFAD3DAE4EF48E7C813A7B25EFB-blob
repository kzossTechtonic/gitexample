!function(t,e,i){var s={version:"2.8.4",canvasList:[],modules:{},inits:{},plugins:{},core:function(t){for(var i in this.isCore=!0,this.id=s.canvasList.push(this)-1,this.lastObjectID=0,this.children=[],this.domEventHandlers=[],s.modules)"function"==typeof s.modules[i]?this[i]=s.modules[i]():this[i]=Object.create(s.modules[i]);if(this.settings={fps:30,background:"transparent",clearEachFrame:!0,drawEachFrame:!0,disableScrolling:!1,plugins:[]},s.extend(this.settings,t),this.originalSettings=s.extend({},this.settings),this.settings.canvas.nodeName&&"canvas"===this.settings.canvas.nodeName.toLowerCase())this.canvasElement=this.settings.canvas;else{if("string"!=typeof this.settings.canvas)return!1;this.canvasElement=e.querySelector(this.settings.canvas)}this.canvas=this.canvasElement.getContext("2d");var n=this.canvasElement.width,r=this.canvasElement.height;for(var i in Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,set:function(t){n=isNaN(parseFloat(t))?n:parseFloat(t),this.canvasElement.width=n,this.background.set(this.settings.background),this.redraw()},get:function(){return n}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,set:function(t){r=isNaN(parseFloat(t))?r:parseFloat(t),this.canvasElement.height=r,this.background.set(this.settings.background),this.redraw()},get:function(){return r}}),s.modules){if(!0===this[i].wrapper)for(var a in this[i])"object"==typeof this[i][a]&&"function"==typeof this[i][a].setCore?this[i][a]=this[i][a].setCore(this):"function"==typeof this[i][a].setCore&&this[i][a].setCore(this),this[i].core=this;this[i].core=this}for(var o in s.inits)if("string"==typeof s.inits[o]&&"function"==typeof this[o][s.inits[o]])this[o][s.inits[o]]();else if("object"===s.inits[o])for(var h in s.inits[o])"function"==typeof this[o][s.inits[o][h]]&&this[o][s.inits[o][h]]();var c=this.settings.plugins;if(c.length>0)for(var l=0,u=c.length;l<u;l++)"function"==typeof s.plugins[c[l]]&&s.plugins[c[l]].call(this)},registerModule:function(t,e,n){if(~t.indexOf(".")){var r=t.split(".");s.modules[r[0]][r[1]]=e,n!==i&&(s.inits[r[0]]||(s.inits[r[0]]={}),s.inits[r[0]][r[1]]=n)}else s.modules[t]=e,n!==i&&(s.inits[t]=n)},registerPlugin:function(t,e){s.plugins[t]=e},create:function(t){return new s.core(t)},domReady:function(t){if(t=t||function(){},this.domReadyHandlers.push(t),this.isDomReadyListening)return!1;if(this.isDomReady)return s.triggerDomReadyHandlers(),!0;var i=function(t){("complete"===e.readyState||t&&"DOMContentLoaded"===t.type)&&(s.isDomReadyListening=!1,s.isDomReady=!0,s.triggerDomReadyHandlers(),e.removeEventListener("readystatechange",i,!1),e.removeEventListener("DOMContentLoaded",i,!1))};return!!i()||(this.isDomReadyListening?void 0:(s.isDomReadyListening=!0,e.addEventListener("readystatechange",i,!1),e.addEventListener("DOMContentLoaded",i,!1),!1))},isDomReady:!1,isDomReadyListening:!1,domReadyHandlers:[],triggerDomReadyHandlers:function(){var t,e,i,s;for(e=0,i=(t=this.domReadyHandlers).length;e<i;e++)(s=t[e])&&(delete t[e],s())}};s.core.prototype={addChild:function(t,e){return t.add(e),this},removeChild:function(t,e){return t.remove(e),this},clear:function(t){return this.draw.clear(t),this},redraw:function(){return this.draw.redraw(),this},bind:function(t,e){return this.events.bind(this.canvasElement,t.split(" "),e),this},unbind:function(t,e){return this.events.unbind(this.canvasElement,t.split(" "),e),this},trigger:function(t,e){var i=this.events;return i.triggerHandlers(this.canvasElement,t.split(" "),i.fixEventObject(e)),this},reset:function(){for(var t=this.children,e=0,i=t.length;e<i;e++)t[e].remove(),e--,i--;t.length=0,this.lastObjectID=0;var n=this.canvasElement.events;for(var r in n)n[r]instanceof Array&&this.unbind(r,n[r]);this.settings=s.extend({},this.originalSettings)},destroy:function(){this.reset();for(var t=0,e=this.domEventHandlers.length;t<e;t++)s.removeDOMEventHandler(this,t);this.domEventHandlers.length=0,s.canvasList[this.id]=null}},t.oCanvas=s,s.domReady(),s.extend=function(){var t,e,i=Array.prototype.slice.call(arguments),n=i[i.length-1],r=i.splice(0,1)[0],a=i.splice(0,1)[0],o=[];if(n.exclude&&JSON.stringify(n)===JSON.stringify({exclude:n.exclude})&&(o=n.exclude),a!==n||0===o.length)for(t in a)~o.indexOf(t)||((e=Object.getOwnPropertyDescriptor(a,t)).get||e.set?Object.defineProperty(r,t,e):r[t]=a[t]);return i.length>0?s.extend.apply(this,[r].concat(i)):r},s.addDOMEventHandler=function(t,e,i,s,n){t.domEventHandlers.push({obj:e,event:i,handler:s,useCapture:!!n}),e.addEventListener(i,s,n)},s.removeDOMEventHandler=function(t,e){var i=t.domEventHandlers[e];i.obj.removeEventListener(i.event,i.handler,i.useCapture)},s.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),"function"!=typeof Object.getPropertyDescriptor&&(Object.getPropertyDescriptor=function(t,e){for(var s=Object.getOwnPropertyDescriptor(t,e),n=Object.getPrototypeOf(t);s===i&&null!==n;)s=Object.getOwnPropertyDescriptor(n,e),n=Object.getPrototypeOf(n);return s}),function(){for(var e=0,i=["ms","moz","webkit","o"],s=0;s<i.length&&!t.requestAnimationFrame;++s)t.requestAnimationFrame=t[i[s]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[s]+"CancelAnimationFrame"]||t[i[s]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i,s){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),a=t.setTimeout(function(){i(n+r)},r);return e=n+r,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),t.log=function(){if(log.history=log.history||[],log.history.push(arguments),this.console){var t,e=Array.prototype.slice.call(arguments),i=e.length;for(t=0;t<i;t++)console.log(e[t])}};s.registerModule("timeline",function(){var t={init:function(){var t=this;this.core.setLoop=function(e){return t.userLoop=e,t}},currentFrame:1,timeline:0,running:!1,set fps(t){this.core.settings.fps=t,this.running&&this.start()},get fps(){return this.core.settings.fps},loop:function(){this.running&&setTimeout(function(){t.timeline=requestAnimationFrame(t.loopBound);var e=t.core;"function"==typeof t.userLoop&&(!0===e.settings.clearEachFrame&&e.draw.clear(),t.userLoop.call(e,e.canvas),!0===e.settings.drawEachFrame&&e.draw.redraw(),t.currentFrame++)},1e3/t.fps)},loopBound:function(){t.loop()},start:function(){return cancelAnimationFrame(t.timeline),t.running=!0,t.loop(),this},stop:function(){return this.running=!1,cancelAnimationFrame(t.timeline),this}};return t},"init");s.registerModule("keyboard",function(){return{keysDown:{},keyPressTimers:{},modifiedKeys:[],init:function(){var t=this;s.addDOMEventHandler(this.core,e,"keydown",function(e){t.docHandler(e)},!1),s.addDOMEventHandler(this.core,e,"keyup",function(e){t.docHandler(e)},!1),s.addDOMEventHandler(this.core,e,"keypress",function(e){t.preventDefault(e)},!1)},docHandler:function(t){var e,i,s,n;if(i=this.core.events,s=this.core.canvasElement,i.enabled&&!(this.core.pointer&&!0!==this.core.pointer.canvasFocused||(e=this.getKeyCode(t),this.preventDefault(t),"keydown"===t.type&&!0===this.keysDown[e]||("keydown"===t.type?this.keysDown[e]=!0:"keyup"===t.type&&delete this.keysDown[e],n=i.fixEventObject(t,"keyboard"),i.lastKeyboardEventObject=n,i.triggerHandlers(s,[t.type]),"keydown"===t.type&&(this.keyPressTimers[e]=setInterval(function(){i.triggerHandlers(s,["keypress"],n)},1e3/this.core.settings.fps)),"keyup"!==t.type))))if(this.anyKeysDown())clearInterval(this.keyPressTimers[e]);else for(e in this.keyPressTimers)clearInterval(this.keyPressTimers[e])},preventDefault:function(t){if(this.core.mouse&&!0===this.core.mouse.canvasFocused||!this.core.mouse){var e=this.getKeyCode(t);~this.modifiedKeys.indexOf(e)&&t.preventDefault()}},addPreventDefaultFor:function(t){t="number"==typeof t?[t]:t instanceof Array?t:[];for(var e=0;e<t.length;e++)this.modifiedKeys.push(t[e])},removePreventDefaultFor:function(t){var e,i;for(t="number"==typeof t?[t]:t instanceof Array?t:[],e=0;e<t.length;e++)~(i=this.modifiedKeys.indexOf(t[e]))&&this.modifiedKeys.splice(i,1)},getKeyCode:function(t){return 0===t.keyCode?t.which:t.keyCode},numKeysDown:function(){var t,e,i;for(i in t=0,e=this.keysDown)!0===e[i]&&t++;return t},anyKeysDown:function(){return this.numKeysDown()>0},getKeysDown:function(){var t,e,i;for(i in e=[],t=this.keysDown)!0===t[i]&&e.push(parseInt(i,10));return e},ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,SPACE:32,ENTER:13,ESC:27}},"init");s.registerModule("mouse",function(){return{x:0,y:0,buttonState:"up",canvasFocused:!1,canvasHovered:!1,cursorValue:"default",init:function(){this.core.events.addEventTypes("mouse",{move:"mousemove",enter:"mouseenter",leave:"mouseleave",down:"mousedown",up:"mouseup",singleClick:"click",doubleClick:"dblclick"}),this.types={mousemove:"move",mousedown:"down",mouseup:"up",dblclick:"doubleClick"},this.core.pointer=this,!this.core.touch||this.core.touch.isTouch,this.bindHandlers()},bindHandlers:function(){var i,n,r,a;for(a in i=this,r=(n=this.core).canvasElement,this.types){s.addDOMEventHandler(n,r,a,function(t){i.canvasHandler(t)},!1),"mousemove"===a&&(a="mouseover"),s.addDOMEventHandler(n,e,a,function(t){i.docHandler(t)},!1);var o=null;try{o=t.parent.document}catch(t){}o&&s.addDOMEventHandler(n,o,a,function(t){i.docHandler(t)},!1)}},canvasHandler:function(t,e){var s,n,r,a;if(s=this.core.events,n=this.onCanvas(t),"mouseup"===t.type&&!n&&!this.canvasUpEventTriggered)return s.triggerPointerEvent(this.types.mouseup,s.frontObject,"mouse",t),s.triggerPointerEvent(this.types.mouseup,this.core.canvasElement,"mouse",t),void(this.canvasUpEventTriggered=!0);(e||n)&&(r=e&&"mouseover"===t.type?"mousemove":t.type,e||(this.canvasHovered=!0),"mousedown"===r&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.buttonState="down"),"mouseup"===r&&(this.buttonState="up"),a=e||!n?i:s.getFrontObject("mouse"),e&&s.frontObject?(s.triggerChain(s.getParentChain(s.frontObject,!0,!0),["mouseleave"]),s.frontObject=null):e?s.triggerHandlers(this.core.canvasElement,["mouseleave"]):s.triggerPointerEvent(this.types[r],a,"mouse",t))},docHandler:function(t){this.onCanvas(t)||(this.core.canvasElement.events.hasEntered?"mouseover"===t.type&&this.canvasHandler(t,!0):("mouseup"===t.type&&"down"===this.buttonState&&this.canvasHandler(t,!0),"mousedown"===t.type&&(this.canvasFocused=!1)))},getPos:function(e){var i=this.core.canvasElement,s=i.getBoundingClientRect(),n=i.width/i.clientWidth,r=i.height/i.clientHeight,a=e.pageX-t.pageXOffset,o=e.pageY-t.pageYOffset;return{x:n*(a-Math.round(s.left)),y:r*(o-Math.round(s.top))}},updatePos:function(t){var e=this.getPos(t);this.x=e.x,this.y=e.y},onCanvas:function(t){var e=(t=t||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent)?this.getPos(t):{x:this.x,y:this.y};return e.x>=0&&e.x<=this.core.width&&e.y>=0&&e.y<=this.core.height?(this.canvasHovered=!0,t&&this.updatePos(t),!0):(this.canvasHovered=!1,!1)},cancel:function(){this.core.events.lastDownObject=null},hide:function(){this.core.canvasElement.style.cursor="none"},show:function(){this.core.canvasElement.style.cursor=this.cursorValue},cursor:function(t){if(~t.indexOf("url(")){var e=/url\((.*?)\)(\s(.*?)\s(.*?)|)($|,.*?$)/.exec(t),i=e[5]?e[5]:"";t="url("+e[1]+") "+(e[3]?e[3]:0)+" "+(e[4]?e[4]:0)+(""!==i?i:", default")}this.core.canvasElement.style.cursor=t,this.cursorValue=t}}},"init");s.registerModule("touch",function(){return{x:0,y:0,touchState:"up",canvasFocused:!1,canvasHovered:!1,isTouch:"ontouchstart"in t||"createTouch"in e,dblTapInterval:500,init:function(){var t,e;e=(t=this.core).canvasElement,t.events.addEventTypes("touch",{move:"touchmove",enter:"touchenter",leave:"touchleave",down:"touchstart",up:"touchend",singleClick:"tap",doubleClick:"dbltap"}),this.types={touchmove:"move",touchstart:"down",touchend:"up"},this.isTouch&&(t.pointer=this,e.style.WebkitUserSelect="none",e.style.WebkitTouchCallout="none",e.style.WebkitTapHighlightColor="rgba(0,0,0,0)"),this.bindHandlers()},bindHandlers:function(){var i,n,r,a;for(a in i=this,r=(n=this.core).canvasElement,this.types){s.addDOMEventHandler(n,r,a,function(t){i.canvasHandler(t)},!1),s.addDOMEventHandler(n,e,a,function(t){i.docHandler(t)},!1);var o=null;try{o=t.parent.document}catch(t){}o&&s.addDOMEventHandler(n,o,a,function(t){i.docHandler(t)},!1)}this.core.settings.disableScrolling&&s.addDOMEventHandler(n,r,"touchmove",function(t){t.preventDefault()},!1)},canvasHandler:function(t,e){var s,n,r,a,o,h;if(s=this.core.events,n=this.onCanvas(t),"touchend"===t.type&&!n&&!this.canvasUpEventTriggered)return s.triggerPointerEvent(this.types.touchend,s.frontObject,"touch",t),s.triggerPointerEvent(this.types.touchend,this.core.canvasElement,"touch",t),void(this.canvasUpEventTriggered=!0);(e||n)&&(e||(this.canvasHovered=!0),"touchstart"===t.type&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.touchState="down"),"touchend"===t.type&&(this.touchState="up"),r=e||!n?i:s.getFrontObject("touch"),e&&s.frontObject?(s.triggerChain(s.getParentChain(s.frontObject,!0,!0),["touchleave"]),s.frontObject=null):e?s.triggerHandlers(this.core.canvasElement,["touchleave"]):s.triggerPointerEvent(this.types[t.type],r,"touch",t),"touchstart"===t.type&&(a=(new Date).getTime(),!this.dblTapStart||a-this.dblTapStart.timestamp>this.dblTapInterval?this.dblTapStart={timestamp:a,obj:r,count:1}:this.dblTapStart.count++),"touchend"===t.type&&2===this.dblTapStart.count&&(a=(new Date).getTime(),o=r===this.dblTapStart.obj,h=a-this.dblTapStart.timestamp,o&&h<this.dblTapInterval&&s.triggerPointerEvent("doubleClick",r,"touch",t),delete this.dblTapStart))},docHandler:function(t){this.onCanvas(t)||(this.core.canvasElement.events.hasEntered?"touchmove"===t.type&&this.canvasHandler(t,!0):("touchend"===t.type&&"down"===this.touchState&&this.canvasHandler(t,!0),"touchstart"===t.type&&(this.canvasFocused=!1)))},getPos:function(e){var s,n,r=e.changedTouches;if(r!==i&&r.length>0){e=r[0];var a=this.core.canvasElement,o=a.getBoundingClientRect(),h=a.width/a.clientWidth,c=a.height/a.clientHeight,l=e.pageX-t.pageXOffset,u=e.pageY-t.pageYOffset;s=h*(l-Math.round(o.left)),n=c*(u-Math.round(o.top))}else s=this.x,n=this.y;return{x:s,y:n}},updatePos:function(t){var e=this.getPos(t);this.x=e.x,this.y=e.y},onCanvas:function(t){var e=(t=t||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent)?this.getPos(t):{x:this.x,y:this.y};return e.x>=0&&e.x<=this.core.width&&e.y>=0&&e.y<=this.core.height?(this.canvasHovered=!0,t&&this.updatePos(t),!0):(this.canvasHovered=!1,!1)},cancel:function(){this.core.events.lastDownObject=null}}},"init");s.registerModule("tools",function(){return{transformPointerPosition:function(t,e,i,s,n){if(s=s||0,n=n||this.core.pointer,"object"==typeof t){var r,a,o,h,c,l=t.parent,u=[],d={x:0,y:0};for(u.push(t);l&&l!==this.core;)u.push(l),l=l.parent;for(u.reverse(),r=n,o=0,h=u.length;o<h;o++)a=u[o],r=d=this.transformPointerPosition(a.rotation,a.abs_x,a.abs_y,0,r);return 0!==s&&(c=t.getOrigin(),d=this.transformPointerPosition(-1*s,e-c.x,i-c.y,0,r)),{x:d.x,y:d.y}}var f,g,p,y=t,_=n.x>=e&&n.y<=i,b=n.x>=e&&n.y>=i,v=n.x<=e&&n.y>=i,m=n.x<=e&&n.y<=i,x=Math.sqrt(Math.pow(n.x-e,2)+Math.pow(n.y-i,2)),w=(y=360*(y/360-Math.floor(y/360))-s,0===x?0:Math.abs(n.y-i)/x);return _||v?(f=(180-y-180*Math.asin(w)/Math.PI)*Math.PI/180,g=e+Math.cos(f)*x*(_?-1:1),p=i+Math.sin(f)*x*(_?-1:1)):(m||b)&&(f=(180*Math.asin(w)/Math.PI-y)*Math.PI/180,g=e+Math.cos(f)*x*(m?-1:1),p=i+Math.sin(f)*x*(m?-1:1)),{x:g,y:p}},isPointerInside:function(t,e){var i=t.getOrigin();if("line"===t.type){var s=Math.abs(t._.end_x-t.abs_x),n=Math.abs(t._.end_y-t.abs_y),r=Math.sqrt(s*s+n*n),a=t.start,o=t.end,h=a.x<o.x&&a.y<o.y||a.x>o.x&&a.y>o.y?-1:1,c=Math.asin(n/r)*(180/Math.PI)*h;return(y=this.transformPointerPosition(t,t.abs_x,t.abs_y,c,e)).x>t.abs_x-r-i.x&&y.x<t.abs_x+r-i.x&&y.y>t.abs_y-t.strokeWidth/2-i.y&&y.y<t.abs_y+t.strokeWidth/2-i.y}if("text"===t.type){var l,u,d,f,g,p,y=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),_=t.strokeWidth/2,b=t._.lines,v=b.length,m=t.size*t.lineHeight,x=t.align,w="rtl"===this.core.canvasElement.dir;for(l={top:.05*t.size,hanging:-.12*t.size,middle:-.47*t.size,alphabetic:-.78*t.size,ideographic:-.83*t.size,bottom:-1*t.size},k=0;k<v;k++)if(u={start:w?t.width-b[k].width:0,left:0,center:(t.width-b[k].width)/2,end:w?0:t.width-b[k].width,right:t.width-b[k].width},f=(d=t.abs_x+u[x])+b[k].width,p=(g=t.abs_y+m*k+l[t.baseline])+m+(v>0&&k<v-1?1:0),y.x>d-i.x-_&&y.x<f-i.x+_&&y.y>g-i.y-_&&y.y<p-i.y+_)return!0;return!1}if("rectangular"===t.shapeType)return y=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),_="outside"===t.strokePosition?t.strokeWidth:"center"===t.strokePosition?t.strokeWidth/2:0,y.x>t.abs_x-i.x-_&&y.x<t.abs_x+t.width-i.x+_&&y.y>t.abs_y-i.y-_&&y.y<t.abs_y+t.height-i.y+_;if("ellipse"===t.type&&t.radius_x===t.radius_y)return y=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),(r=Math.sqrt(Math.pow(y.x-t.abs_x+i.x,2)+Math.pow(y.y-t.abs_y+i.y,2)))<t.radius_x+t.strokeWidth/2;if("ellipse"===t.type){y=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e);var O=t.radius_x+t.strokeWidth/2,M=t.radius_y+t.strokeWidth/2;return y.x-=t.abs_x+i.x,y.y-=t.abs_y+i.y,y.x*y.x/(O*O)+y.y*y.y/(M*M)<1}if("polygon"===t.type){y=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e);var k,P,C,j=t.radius+t.strokeWidth/2,E=t.sides,T=E-1,D=!1;for(k=0;k<E;k++)P={x:t.abs_x-i.x+j*Math.cos(2*k*Math.PI/E),y:t.abs_y-i.y+j*Math.sin(2*k*Math.PI/E)},C={x:t.abs_x-i.x+j*Math.cos(2*T*Math.PI/E),y:t.abs_y-i.y+j*Math.sin(2*T*Math.PI/E)},(P.y<y.y&&C.y>=y.y||C.y<y.y&&P.y>=y.y)&&P.x+(y.y-P.y)/(C.y-P.y)*(C.x-P.x)<y.x&&(D=!D),T=k;return D}if("arc"===t.type){var F,H,W=t.end-t.start,I="clockwise"===t.direction?(W<0?360:0)+(W%360?W%360:W>0?360:0):Math.abs(W),N="clockwise"===t.direction?-1*t.start:-1*t.end,S=(y=this.transformPointerPosition(t,t.abs_x,t.abs_y,N,e),r=Math.sqrt(Math.pow(y.x-t.abs_x+i.x,2)+Math.pow(y.y-t.abs_y+i.y,2)),j=t.radius,{}),z={};if(0===t.strokeWidth&&r>j||t.strokeWidth>0&&r>j+t.strokeWidth/2)return!1;if(j===t.strokeWidth/2||t.pieSection){var A,q,R,L,B=t.pieSection?t.radius:B;if(I>180)return A=Math.abs(t.abs_x-i.x-y.x),q=Math.abs(t.abs_y-i.y-y.y),R=Math.sqrt(A*A+q*q),L=180*Math.acos(A/R)/Math.PI,y.y>=t.abs_y-i.y&&r<=B||y.y<t.abs_y-i.y&&y.x<t.abs_x-i.x&&L<=I-180;if(180===I)return y.y>=t.abs_y-i.y&&r<=B;if(I<180)return N=90-I/2-("clockwise"===t.direction?t.start:t.end),y=this.transformPointerPosition(t,t.abs_x,t.abs_y,N,e),j*=2,V=Math.cos(I/2*Math.PI/180)*j,A=Math.abs(t.abs_x-i.x-y.x),q=Math.abs(t.abs_y-i.y-y.y),R=Math.sqrt(A*A+q*q),L=180*Math.asin(A/R)/Math.PI,y.y>=t.abs_y-i.y+V||y.y>=t.abs_y-i.y&&L<=I/2}else{if(I>180){O=(360-I)/2,F=Math.cos(O*Math.PI/180)*j,S.x=t.abs_x-i.x+Math.cos(O*Math.PI/180)*F,S.y=t.abs_y-i.y-Math.sin(O*Math.PI/180)*F,H=180-2*O,z.x=t.abs_x-i.x-Math.cos(H*Math.PI/180)*j,z.y=t.abs_y-i.y-Math.sin(H*Math.PI/180)*j;var X=90-(90-H)-(90-O);if(y.y<S.y&&y.x<S.x)c=O-180*Math.acos(Math.abs(y.y-S.y)/Math.sqrt(Math.pow(y.x-S.x,2)+Math.pow(y.y-S.y,2)))/Math.PI;else if(y.y>S.y&&y.x>=S.x)c=X-180*Math.acos(Math.abs(y.x-S.x)/Math.sqrt(Math.pow(y.x-S.x,2)+Math.pow(y.y-S.y,2)))/Math.PI;else{if(y.y<t.abs_y-i.y&&y.x>=S.x)return!1;c=-1e6}return!((""===t.fill||"transparent"===t.fill)&&t.strokeWidth>0&&r<j-t.strokeWidth/2)&&(c<=0&&y.x>=z.x&&y.y>S.y&&y.y<t.abs_y-i.y||c<=0&&y.y<=t.abs_y-i.y&&r<=j||(0===t.strokeWidth&&r<=j||t.strokeWidth>0&&r<=j+t.strokeWidth/2)&&(y.x<=z.x&&y.y<=t.abs_y-i.y||y.y>=t.abs_y-i.y))}if(180===I)return y.y>=t.abs_y-i.y&&(0===t.strokeWidth&&r<=j||t.strokeWidth>0&&r<=j+t.strokeWidth/2);var Y,V;if(I<180)return N=90-I/2-("clockwise"===t.direction?t.start:t.end),y=this.transformPointerPosition(t,t.abs_x,t.abs_y,N,e),Y=""===t.fill?j-t.strokeWidth/2:j,V=Math.cos(I/2*Math.PI/180)*Y,""===t.fill&&t.strokeWidth>0?y.y>=t.abs_y-i.y+V&&r>=j-t.strokeWidth/2&&r<=j+t.strokeWidth/2:y.y>=t.abs_y-i.y+V&&(!(t.strokeWidth>0)||r<=j+t.strokeWidth/2)}}else if("radial"===t.shapeType&&(j=t.radius?t.radius:0)>0)return y=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),i=t.getOrigin(),(r=Math.sqrt(Math.pow(y.x-t.abs_x+i.x,2)+Math.pow(y.y-t.abs_y+i.y,2)))<j}}});s.registerModule("events",function(){return{enabled:!0,eventTypes:{},init:function(){this.core.canvasElement.events={}},addEventTypes:function(t,e){this.eventTypes[t]=this.eventTypes[t]||[];var i=this.eventTypes[t];for(var s in e)i[s]=i[s]||[],i[s].push(e[s])},bind:function(t,e,i){for(var s=0;s<e.length;s++)t.events[e[s]]=t.events[e[s]]||[],t.events[e[s]].push(i)},unbind:function(t,e,s){var n,r,a;for(n=0;n<e.length;n++)(r=t.events[e[n]])!==i&&(s===i?delete t.events[e[n]]:~(a=r.indexOf(s))&&r.splice(a,1))},findFrontObject:function(t,e){var i,s,n;if(0===t.length)return!1;for(i=t.length;i--&&(s=t[i],!1===(n=this.findFrontObject(s.children,e)));)if(s.pointerEvents&&s.isPointerInside(e)){n=s;break}return n},getFrontObject:function(t){return this.findFrontObject(this.core.children,this.core[t])||i},triggerPointerEvent:function(t,e,i,s){if(this.enabled){var n,r,a,o,h,c,l,u,d,f,g;if(n=this.core.canvasElement,a=(r=this.eventTypes[i]).enter,o=r.leave,h=r[t],c=r.singleClick,this.lastPointerEventObject=this.fixEventObject(s,i),e){if(e!==this.frontObject){if(this.frontObject&&!~(l=this.getParentChain(e)).indexOf(this.frontObject))if(this.triggerHandlers(this.frontObject,o),~(l=this.getParentChain(this.frontObject)).indexOf(e)){for(u=[],f=0,g=l.length;f<g&&l[f]!==e;f++)u.push(l[f]);this.triggerChain(u,o)}else this.triggerChain(l,o);this.frontObject=e,(e.parent||n).events.hasEntered||(l=this.findNonEnteredParentChain(e),this.triggerChain(l,a)),e.events.hasEntered||this.triggerHandlers(e,a)}}else this.frontObject?(u=this.getParentChain(this.frontObject,!1,!0),this.triggerChain(u,o),this.frontObject=null):n.events.hasEntered||this.triggerHandlers(n,a),e=this.core.canvasElement;"down"===t&&(this.lastDownObject=e),u=this.getParentChain(e,!0,!0),this.triggerChain(u,h),"up"===t&&(e===this.lastDownObject?this.triggerChain(u,c):(d=this.getSharedParent(e,this.lastDownObject))&&(u=this.getParentChain(d,!0,!0),this.triggerChain(u,c)),this.lastDownObject=null)}},getSharedParent:function(t,e){var s,n,r;for(s=this.getParentChain(t,!0,!0),n=this.core.canvasElement,r=e;r&&!~s.indexOf(r);)r=r.parent||(r!==n?n:i);return r},findNonEnteredParentChain:function(t){var e,i,s;for(e=[],i=this.core.canvasElement,s=t.parent;s&&!s.events.hasEntered;)e.push(s),s=s.parent;return s||i.events.hasEntered||e.push(i),e.reverse()},getParentChain:function(t,e,i){var s,n;for(s=[],i&&s.push(t),n=t.parent;n;)s.push(n),n=n.parent;return e&&t!==this.core.canvasElement&&s.push(this.core.canvasElement),s},triggerChain:function(t,e,i){var s,n;for(s=0,n=t.length;s<n&&this.triggerHandlers(t[s],e,i);s++);},triggerHandlers:function(t,e,i){var s,n,r,a,o,h,c,l=t===this.core.canvasElement?this.core:t;for(s=0;s<e.length;s++)if(n=t.events[e[s]],r=!!~e[s].indexOf("enter"),a=!!~e[s].indexOf("leave"),(c=i||(~e[s].indexOf("key")?this.lastKeyboardEventObject:this.lastPointerEventObject)).type=e[s],c.bubbles=!r&&!a,r&&!t.events.hasEntered?t.events.hasEntered=!0:a&&t.events.hasEntered&&(t.events.hasEntered=!1),n){for(o=n.length,h=0;h<o;h++)"function"==typeof n[h]&&n[h].call(l,c);if(c.stoppingPropagation)return c.stoppingPropagation=!1,!1}return!0},fixEventObject:function(t,e){var s,n,r,a,o="altKey ctrlKey metaKey shiftKey button charCode keyCode clientX clientY pageX pageY screenX screenY detail eventPhase isChar touches targetTouches changedTouches scale rotation".split(" "),h=o.length;if(s={originalEvent:t,timeStamp:(new Date).getTime(),which:t===i?0:0===t.which?t.keyCode:t.which,preventDefault:function(){t!==i&&t.preventDefault()},stopPropagation:function(){this.bubbles&&(this.stoppingPropagation=!0),t!==i&&t.stopPropagation()}},t===i)return s;for(n=0;n<h;n++)r=o[n],t[r]!==i&&(s[r]=t[r]);return~"mouse touch".indexOf(e)&&(s.x=this.core[e].x,s.y=this.core[e].y),"mouse"===e&&(a={0:1,2:2,1:3,default:0},s.which=a[s.button]||a.default),"touch"===e&&(s.which=0),s}}},"init");s.registerModule("draw",function(){return{objects:[],translation:{x:0,y:0},changeZorder:function(t,e,s){var n,r,a,o=t.children,h=o[e];o[s],h!==i&&e!==s&&(s>o.length-1&&(s=o.length-1),s<0&&(s=0),s>e?(n=o.slice(0,e),a=o.slice(s+1,o.length),(r=o.slice(e,s+1)).shift(),r.push(h)):(n=o.slice(0,s),a=o.slice(e+1,o.length),(r=o.slice(s,e+1)).pop(),r.unshift(h)),t.children=n.concat(r).concat(a))},clear:function(t){return this.core.canvas.clearRect(0,0,this.core.width,this.core.height),!1!==t&&this.core.background.redraw(),this.isCleared=!0,this},redraw:function(t){return t=t||!1,(this.core.settings.clearEachFrame||t)&&this.clear(),this.isCleared=!1,this.drawObjects(this.core.children),this},drawObjects:function(t){var e,s,n,r,a,o,h,c=this.core.canvas;for(e=0,s=t.length;e<s;e++)if((n=t[e])!==i&&"function"==typeof n.draw){"function"==typeof n.update&&n.update(),c.save(),c.translate(n.x,n.y),0!==n.rotation&&c.rotate(n.rotation*Math.PI/180),1===n.scalingX&&1===n.scalingY||c.scale(n.scalingX,n.scalingY),h=n.opacity;for(var l=n.parent;l&&l!==this.core;)h*=l.opacity,l=l.parent;this.translation={x:n.abs_x,y:n.abs_y},r=n.abs_x,a=n.abs_y,n._.abs_x=0,n._.abs_y=0,c.globalAlpha=isNaN(parseFloat(h))?1:parseFloat(h),c.globalCompositeOperation=n.composition,(o=n.shadow).blur>0&&(c.shadowOffsetX=o.offsetX,c.shadowOffsetY=o.offsetY,c.shadowBlur=o.blur,c.shadowColor=o.color),c.lineCap=n.cap,c.lineJoin=n.join,c.miterLimit=n.miterLimit,n.draw(),n.drawn=!0,n._.abs_x=r,n._.abs_y=a,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,n.children.length>0&&this.drawObjects(n.children),c.restore(),this.translation={x:0,y:0}}}}});s.registerModule("background",function(){return{bg:"",value:"",type:"transparent",loaded:!1,init:function(){this.set(this.core.settings.background)},set:function(t){var e=this;if("string"!=typeof t&&(t=""),this.value=t,~t.indexOf("gradient")?this.type="gradient":~t.indexOf("image")?this.type="image":this.core.style&&this.core.style.isColor(t)?this.type="color":this.type="transparent","color"===this.type)this.bg=t,this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if("gradient"===this.type)this.bg=this.core.style?this.core.style.getGradient(t,0,0,this.core.width,this.core.height):"",this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if("image"===this.type){var i=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(t),s=i[1],n=i[4]||"repeat",r=new Image;r.src=s,r.onload=function(){e.bg=e.core.canvas.createPattern(this,n),e.loaded=!0,e.core.timeline&&!e.core.timeline.running&&e.core.redraw(!0)}}else this.redraw(!0),this.loaded=!0;return this},redraw:function(){var t=this.core;"transparent"!==this.type&&(t.canvas.fillStyle=this.bg,t.canvas.fillRect(0,0,t.width,t.height))}}},"init");s.registerModule("scenes",function(){return{current:"none",scenes:{},create:function(t,e){return this.scenes[t]=Object.create(this.scenesBase()),this.scenes[t].name=t,e.call(this.scenes[t]),this.scenes[t]},scenesBase:function(){return{name:"",objects:[],loaded:!1,add:function(t){return this.objects.push(t),this.loaded&&t.add(),this},remove:function(t){var e=this.objects.indexOf(t);return~e&&(this.objects.splice(e,1),this.loaded&&t.remove()),this},load:function(){if(!this.loaded){var t,e=this.objects,s=e.length;for(t=0;t<s;t++)e[t]!==i&&e[t].add(!1);return this.loaded=!0,this}},unload:function(){var t,e=this.objects,s=e.length;for(t=0;t<s;t++)e[t]!==i&&e[t].remove(!1);return this.loaded=!1,this}}},load:function(t,e){return!0===e&&"none"!==this.current&&this.unload(this.current),this.current=t,this.scenes[t].load(),this.core.draw.redraw(),this},unload:function(t){return this.current="none",this.scenes[t].unload(),this.core.draw.redraw(),this}}});s.registerModule("style",function(){return{getStroke:function(t,e){if(e="string"===e?"string":"object","object"==typeof t&&"string"===e){var s=t;t="string"==typeof s.pos?s.pos:"center",t+=" "+("number"==typeof s.width?s.width+"px":"1px"),t+=" "+("string"==typeof s.color?s.color:"#000000")}for(var n,r,a=t.split(" "),o=0,h=a.length;o<h;o++)!n&&a[o].indexOf("(")>-1&&(n=o),a[o].indexOf(")")>-1&&(r=o);(c=r?a.splice(n,r-n+1):i)&&a.push(c.join(" "));var c,l,u="",d=a.length;if(d>=3)if(~["outside","center","inside"].indexOf(a[0])){if(d>3){for(o=2;o<d;o++)u+=a[o]+(o===d-1?" ":"");a=[a[0],a[1],u]}a={pos:a[0],width:parseFloat(a[1]),color:a[2]}}else{for(o=(l=isNaN(parseInt(a[0])))?0:1;o<d;o++)u+=a[o]+(o===d-1?" ":"");a=l?[1,u]:[a[0],u],d=2}return 2===d&&(a={pos:"center",width:parseFloat(a[0]),color:a[1]}),a.length&&(a={pos:"center",width:0,color:""}),"string"===e?a.pos+" "+a.width+"px "+a.color:"object"===e?a:void 0},getGradient:function(t,e,i,s,n){return~t.indexOf("linear")?this.getLinearGradient(t,e,i,s,n):~t.indexOf("radial")?this.getRadialGradient(t,e,i,s,n):"transparent"},getLinearGradient:function(t,e,i,s,n){var r,a,o,h,c,l,u,d,f,g,p,y,_=[],b=["top","bottom","left","right"],v=[];for(a=/\((.*)\)/.exec(t)[1];f=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(a);)g=v.push(f[1])-1,a=a.substring(0,f.index)+"###"+g+"###"+a.substring(f.index+f[1].length,a.length);if(o=(a=a.split(","))[0].split(" "),(~b.indexOf(o[0])||~o[0].indexOf("deg"))&&_.push(o[0]),o.length>1&&~b.indexOf(o[1])&&_.push(o[1]),0===_.length?_.push("top"):h=1,1===_.length){if("top"===_[0])c=e+s/2,l=i,u=e+s/2,d=i+n;else if("right"===_[0])c=e+s,l=i+n/2,u=e,d=i+n/2;else if("bottom"===_[0])c=e+s/2,l=i+n,u=e+s/2,d=i;else if("left"===_[0])c=e,l=i+n/2,u=e+s,d=i+n/2;else if(~_[0].indexOf("deg")){var m,x,w,O,M,k,P,C=Math.PI,j=e+s/2,E=i+n/2;x=m=parseFloat(_)%360*C/180,m>=0&&m<C/2?(M=e+s,k=i):m>=C/2&&m<C?(P=E,E=j,k=e,M=P,j=i):m>=C&&m<1.5*C?(P=E,M=j,j=e,E=i+n,k=P):m>=1.5*C&&m<2*C&&(P=E,E=e+s,k=j,M=i+n,j=P),m%=C/2,w=Math.atan(Math.abs(E-k)/Math.abs(M-j)),O=Math.sqrt(Math.pow(E-k,2)+Math.pow(j-M,2))*Math.cos(w-m),x>=0&&x<C/2?(c=2*j-(u=j+O*Math.cos(m)),l=2*E-(d=E-O*Math.sin(m))):x>=C/2&&x<C?(c=2*E-(u=E-O*Math.cos(C/2-m)),l=2*M-(d=M-O*Math.sin(C/2-m))):x>=C&&x<1.5*C?(c=2*M-(u=M+O*Math.cos(C-m)),l=2*k-(d=k+O*Math.sin(C-m))):x>=1.5*C&&x<2*C&&(c=2*k-(u=k-O*Math.cos(1.5*C-m)),l=2*j-(d=j-O*Math.sin(1.5*C-m)))}}else~_.indexOf("top")&&~_.indexOf("left")?(c=e,l=i,u=e+s,d=i+n):~_.indexOf("top")&&~_.indexOf("right")?(c=e+s,l=i,u=e,d=i+n):~_.indexOf("bottom")&&~_.indexOf("left")?(c=e,l=i+n,u=e+s,d=i):~_.indexOf("bottom")&&~_.indexOf("right")&&(c=e+s,l=i+n,u=e,d=i);for(r=this.core.canvas.createLinearGradient(c,l,u,d),p=this.getColorStops(r,a.slice(h),v),y=0;y<p.length;y++)r.addColorStop(p[y].pos/100,p[y].color);return r},getRadialGradient:function(t,e,s,n,r){var a,o,h,c,l,u,d,f,g,p,y,_=["left","center","right"],b=["top","center","bottom"],v={left:e,center:e+n/2,right:e+n},m={top:s,center:s+r/2,bottom:s+r},x=["closest-side","closest-corner","farthest-side","farthest-corner","contain","cover"],w=[],O=0,M=[{x:i,y:i,r:0},{x:i,y:i,r:i}],k=!1;for(o=/\((.*)\)/.exec(t)[1];c=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(o);)l=w.push(c[1])-1,o=o.substring(0,c.index)+"###"+l+"###"+o.substring(c.index+c[1].length,o.length);for((o=o.split(/\s*,\s*/)).length,h=0;h<2;h++)~o[h].indexOf(" ")?("center"===(f=o[h].split(" "))[0]?(M[h].x=f[0],M[h].y=f[1],O=h+1):~_.indexOf(f[0])?(M[h].x=f[0],O=h+1,~b.indexOf(f[1])&&(M[h].y=f[1])):~b.indexOf(f[0])?(M[h].y=f[0],O=h+1,~_.indexOf(f[1])&&(M[h].x=f[1])):isNaN(parseFloat(f[0]))||(M[h].x=f[0],O=h+1,!~b.indexOf(f[1])&&isNaN(parseFloat(f[1]))||(M[h].y=f[1])),M[h].x||(M[h].x="center"),M[h].y||(M[h].y="center")):(~_.indexOf(o[h])?(M[h].x=o[h],O=h+1):~b.indexOf(o[h])?(M[h].y=o[h],O=h+1):M[h].x=1===h?M[0].x:"center",M[h].y=1===h?M[0].y:"center");for(~x.indexOf(o[O])&&(y=o[O],k=!0),/\d+(%|px)\s/.test(o[O])&&(y=parseFloat(o[O]),k=!0,isNaN(y)&&(y=0)),y===i&&(y="cover"),h=0;h<2;h++)for(M[h].abs_x=v[M[h].x],M[h].abs_y=m[M[h].y],g=0;g<2;g++)p="abs_"+(0===g?"x":"y"),M[h][p]===i&&(M[h][p]=parseFloat(M[h]["abs_x"===p?"x":"y"]),isNaN(M[h][p])&&(M[h][p]="abs_x"===p?v.center-e:m.center-s),~M[h]["abs_x"===p?"x":"y"].indexOf("%")&&(M[h][p]=M[h][p]/100*("abs_x"===p?n:r)),M[h][p]+="abs_x"===p?e:s);for(~x.indexOf(y)&&(y="closest-side"===y||"contain"===y?Math.min(Math.abs(M[1].abs_y-s),Math.abs(s+r-M[1].abs_y),Math.abs(M[1].abs_x-e),Math.abs(e+n-M[1].abs_y)):"closest-corner"===y?Math.min(Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+n-M[1].abs_x,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+n-M[1].abs_x,2)+Math.pow(s+r-M[1].abs_y,2)),Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(s+r-M[1].abs_y,2))):"farthest-corner"===y||"cover"===y?Math.max(Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+n-M[1].abs_x,2)+Math.pow(M[1].abs_y-s,2)),Math.sqrt(Math.pow(e+n-M[1].abs_x,2)+Math.pow(s+r-M[1].abs_y,2)),Math.sqrt(Math.pow(M[1].abs_x-e,2)+Math.pow(s+r-M[1].abs_y,2))):"farthest-side"===y?Math.max(Math.abs(M[1].abs_y-s),Math.abs(s+r-M[1].abs_y),Math.abs(M[1].abs_x-e),Math.abs(e+n-M[1].abs_y)):0),~o[O].indexOf("%")&&(y=y/100*(~o[O].indexOf(" ")&&"height"===o[O].split(" ")[1]?r:n)),M[1].r=y,a=this.core.canvas.createRadialGradient(M[0].abs_x,M[0].abs_y,M[0].r,M[1].abs_x,M[1].abs_y,M[1].r),u=this.getColorStops(a,o.slice(O+(k?1:0)),w),d=0;d<u.length;d++)a.addColorStop(u[d].pos/100,u[d].color);return a},getColorStops:function(t,e,s){var n,r,a,o,h,c=e.length,l=[];for(n=0;n<c&&(r=e[n].trim(),!(h>=100));n++)~r.indexOf(" ")?(o=(a=r.split(" "))[0],h=~(h=a[1]).indexOf("px")?parseFloat(h)/Math.sqrt(Math.pow(eX-sX,2)+Math.pow(eY-sY,2))*100:parseFloat(h)):(o=r,h===i?h=0:(h=h||0,h+=(100-h)/(c-n))),~o.indexOf("###")&&(o=s[/###(\d+)###/.exec(o)[1]]),l.push({pos:h,color:o});return l},getFont:function(t,e){if(e="string"===e?"string":"object","object"==typeof t&&"string"===e){var s=t;t="string"==typeof s.style?s.style:"normal",t+=" "+("string"==typeof s.variant?s.variant:"normal"),t+=" "+("string"==typeof s.weight?s.weight:"normal"),t+=" "+("number"==typeof s.size?~~(10*s.size+.5)/10+"px":"16px"),t+="/"+("number"==typeof s.lineHeight?~~(10*s.lineHeight+.5)/10:"string"==typeof s.lineHeight&&s.lineHeight.indexOf("px")>-1?s.lineHeight:1),t+=" "+("string"==typeof s.family?s.family:"sans-serif")}if(t.length>0){var n,r,a,o=t.split(" "),h=o.length,c="",l=["normal","italic","oblique"],u=["normal","small-caps"],d=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],f={};for(n=0;n<h;n++)if(t=o[n],~l.indexOf(t)&&!f.style)f.style=t;else if(~u.indexOf(t)&&!f.variant)f.variant=t;else if(~d.indexOf(t)&&!f.weight)f.weight=t;else if(!~t.indexOf("/")||f.size||f.lineHeight){if(!f.size&&/\d+[a-z]{2}(?!\/)/.test(t))isNaN(parseInt(t))||(f.size=parseInt(t));else if(isNaN(parseInt(t))&&!f.family){for(c="",a=n;a<h;a++)c+=o[a]+(a===h-1?"":" ");f.family=c}}else r=t.split("/"),isNaN(parseInt(r[0]))||(f.size=parseInt(r[0])),isNaN(parseFloat(r[1]))||(f.lineHeight=parseFloat(r[1]),f.lineHeightUnit=r[1].indexOf("px")>-1?"px":"relative")}return(o=f||{}).style=o.style?o.style:"normal",o.variant=o.variant?o.variant:"normal",o.weight=o.weight?o.weight:"normal",o.size=o.size!==i?o.size:16,o.lineHeight=o.lineHeight!==i?o.lineHeight:1,o.lineHeightUnit=o.lineHeightUnit!==i?o.lineHeightUnit:"relative",o.family=o.family?o.family:"sans-serif","string"===e?o.style+" "+o.variant+" "+o.weight+" "+o.size+"px/"+o.lineHeight+("px"===o.lineHeightUnit?"px":"")+" "+o.family:"object"===e?o:void 0},getShadow:function(t,e){var i={};if("object"==typeof t)i.offsetX=isNaN(parseFloat(t.offsetX))?0:parseFloat(t.offsetX),i.offsetY=isNaN(parseFloat(t.offsetY))?0:parseFloat(t.offsetY),i.blur=isNaN(parseFloat(t.blur))?0:parseFloat(t.blur),i.color=this.isColor(t.color)?t.color:"#000";else if("string"==typeof t){var s=/^(.*?)\s(.*?)\s(.*?)\s(.*?)$/.exec(t);i.offsetX=isNaN(parseFloat(s[1]))?0:parseFloat(s[1]),i.offsetY=isNaN(parseFloat(s[2]))?0:parseFloat(s[2]),i.blur=isNaN(parseFloat(s[3]))?0:parseFloat(s[3]),i.color=this.isColor(s[4])?s[4]:"#000"}return"string"===e?i.offsetX+"px "+i.offsetY+"px "+i.blur+"px "+i.color:i},isColor:function(t){return"string"==typeof t&&("#"===t[0]||"rgb("===t.substr(0,4)||"rgba("===t.substr(0,5)||"hsl("===t.substr(0,4)||"hsla("===t.substr(0,5))}}}),t.logs=[];s.registerModule("animation",function(){var t={durations:{short:500,normal:1e3,long:2e3},defaults:{duration:"normal",easing:"ease-in-out"},animate:function(t,e){var i=this.parseArguments(e),s=i.properties,n=i.options,r=this.queues.create(t,n.queue),a={obj:t,properties:s,startValues:{},diffValues:{},options:{queue:r,duration:n.duration,easing:n.easing,callback:n.callback}};r.add(a),r.run()},parseArguments:function(t){var e;return(t=Array.prototype.slice.call(t))[1]=t[1]||{},"object"==typeof t[1]?(props=t[0],(e=s.extend({duration:this.defaults.duration,easing:this.defaults.easing,queue:"default",callback:function(){}},t[1])).easing=this.parseEasingOption(e.easing),e.duration=this.parseDurationOption(e.duration)):(props=t.shift(),e=this.getAnimateArguments(t)),{properties:props,options:e}},parseEasingOption:function(t){return"string"==typeof t?~t.indexOf("cubic-bezier")?this.getCustomCubicBezier(t)||this.easing[this.defaults.easing]:this.easing[t]||this.easing[this.defaults.easing]:"function"==typeof t?t:this.easing[this.defaults.easing]},parseDurationOption:function(e){var i=t.durations;return"string"==typeof e?i[e]||i[t.defaults.duration]:e},runAnimation:function(t,e){var i;i=t.obj,t.options,t.advanceCallback=e,this.mainTimer.add(t);var s=this.parseProperties(t.properties,i);t.properties=s.properties,t.startValues=s.startValues,t.diffValues=s.diffValues,t.startTime=(new Date).getTime()},parseProperties:function(t,e){var i={},n={};for(var r in t)if(s.isNumber(t[r]))i[r]=e[r]||0,n[r]=t[r]-(e[r]||0);else if("object"==typeof t[r]){var a=this.parseProperties(t[r],e[r]);i[r]=a.startValues,n[r]=a.diffValues}else delete t[r];return{properties:t,startValues:i,diffValues:n}},tick:function(t){var e,i,s,n,r,a;if((i=(e=(new Date).getTime()-t.startTime)/t.options.duration)>1)return this.setEndValues(t),!1;for(a in s=1===t.options.easing.length?t.options.easing.call(this.easing,i):t.options.easing.call(this.easing,e,0,1,t.options.duration),n=t.startValues,r=t.diffValues)this.setObjectProperty(t.obj,a,n[a],r[a],s);return!0},setObjectProperty:function(t,e,i,n,r){if(s.isNumber(i))t[e]=i+n*r;else for(var a in i)this.setObjectProperty(t[e],a,i[a],n[a],r)},setEndValues:function(t){var e=t.obj,i=t.startValues,s=t.diffValues;for(var n in t.properties)this.setObjectProperty(e,n,i[n],s[n],1);this.core.timeline.running||this.core.draw.redraw(!0)},getAnimateArguments:function(t){var e,s,n,r;return"number"==typeof t[0]?e=t[0]:"string"==typeof t[0]?t[0]in this.durations?e=this.durations[t[0]]:t[0]in this.easing&&(s=this.easing[t[0]]):"boolean"==typeof t[0]?n=t[0]:"function"==typeof t[0]&&"function"==typeof t[1]&&(s=t[0],r=t[1]),"string"==typeof t[1]?s=this.easing[t[1]]:"function"==typeof t[1]&&(t[2]!==i?s=t[1]:r=t[1]),t[2]!==i&&("function"==typeof t[2]?r=t[2]:n=!!t[2]),t[3]!==i&&(r=t[3]),s||((s=~(s="string"==typeof t[0]?t[0]:"").indexOf("cubic-bezier")?s:i)||(s=~(s="string"==typeof t[1]?t[1]:"").indexOf("cubic-bezier")?s:i),s&&(s=this.getCustomCubicBezier(s))),{duration:e=e||this.durations[this.defaults.duration],easing:s=s||this.easing[this.defaults.easing],queue:(n=n!==i&&n)?i:"default",callback:r=r||function(){}}},getCustomCubicBezier:function(t){var e,i,s,n,r;if(e=t.match(/cubic-bezier\(\s*(.*?),\s*(.*?),\s*(.*?),\s*(.*?)\)/))return i=isNaN(parseFloat(e[1]))?0:parseFloat(e[1]),s=isNaN(parseFloat(e[2]))?0:parseFloat(e[2]),n=isNaN(parseFloat(e[3]))?1:parseFloat(e[3]),r=isNaN(parseFloat(e[4]))?1:parseFloat(e[4]),function(t){return this.cubicBezier(i,s,n,r,t)}},stop:function(t){for(var e in t.animationQueues)t.animationQueues[e].clear(!1)},finish:function(t){for(var e in t.animationQueues)t.animationQueues[e].clear(!0)},delay:function(t,e,i){var s=t.animationQueues[i&&i.queue||"default"];s&&s.add({type:"delay",duration:e||0})},mainTimer:{animations:[],add:function(t){this.animations.push(t),1===this.animations.length&&this.start()},remove:function(t){this.animations.splice(this.animations.indexOf(t),1),0===this.animations.length&&this.stop()},start:function(){this.tick()},stop:function(){cancelAnimationFrame(this.timer)},tick:function(){var e=this;setTimeout(function(){e.timer=requestAnimationFrame(function(){e.tick()});for(var i,s=e.animations,n=0,r=s.length;n<r;n++)(i=s[n]).cancelled||t.tick(i)||(t.mainTimer.remove(i),n--,r--,i.advanceCallback(),i.options.callback.call(i.obj));t.core.timeline.running||t.core.draw.redraw(!0)},1e3/t.core.settings.fps)}},queues:{create:function(e,s){return s===i&&(s=Math.round((new Date).getTime()*Math.random()).toString()),e.animationQueues[s]||(e.animationQueues[s]={name:s,list:[],isRunning:!1,add:function(t){this.list.push(t)},remove:function(t){if(t){var e=this.list.indexOf(t);~e&&this.list.splice(e,1)}else this.list.shift()},run:function(){if(!this.isRunning&&this.list.length>0){this.isRunning=!0;var e=this.list[0],i=this;"delay"===e.type?setTimeout(function(){i.advance()},e.duration):t.runAnimation(e,function(){i.advance()})}},advance:function(){this.list.shift(),this.isRunning=!1,this.run()},clear:function(e){if(this.isRunning){var i=this.list[0];i.cancelled=!0,e&&(t.setEndValues(i),i.options.callback.call(i.obj)),this.isRunning=!1,t.mainTimer.remove(i)}this.list.length=0}}),this.get(e,s)},get:function(t,e){return t.animationQueues[e]}},easing:{"ease-in":function(t){return this.cubicBezier(.42,0,1,1,t)},"ease-out":function(t){return this.cubicBezier(0,0,.58,1,t)},"ease-in-out":function(t){return this.cubicBezier(.42,0,.58,1,t)},linear:function(t){return t},"ease-in-quad":function(t,e,i,s){return i*(t/=s)*t+e},"ease-out-quad":function(t,e,i,s){return-i*(t/=s)*(t-2)+e},"ease-in-out-quad":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},"ease-in-cubic":function(t,e,i,s){return i*(t/=s)*t*t+e},"ease-out-cubic":function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},"ease-in-out-cubic":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},"ease-in-quart":function(t,e,i,s){return i*(t/=s)*t*t*t+e},"ease-out-quart":function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},"ease-in-out-quart":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},"ease-in-quint":function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},"ease-out-quint":function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},"ease-in-out-quint":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},"ease-in-sine":function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},"ease-out-sine":function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},"ease-in-out-sine":function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},"ease-in-expo":function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e},"ease-out-expo":function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},"ease-in-out-expo":function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},"ease-in-circ":function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},"ease-out-circ":function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},"ease-in-out-circ":function(t,e,i,s){return(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},"ease-in-elastic":function(t,e,i,s,n,r){if(0==t)return e;if(1==(t/=s))return e+i;if(r||(r=.3*s),(n=n||0)<Math.abs(i)){n=i;var a=r/4}else a=r/(2*Math.PI)*Math.asin(i/n);return-n*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/r)+e},"ease-out-elastic":function(t,e,i,s,n,r){if(0==t)return e;if(1==(t/=s))return e+i;if(r||(r=.3*s),(n=n||0)<Math.abs(i)){n=i;var a=r/4}else a=r/(2*Math.PI)*Math.asin(i/n);return n*Math.pow(2,-10*t)*Math.sin((t*s-a)*(2*Math.PI)/r)+i+e},"ease-in-out-elastic":function(t,e,i,s,n,r){if(0==t)return e;if(2==(t/=s/2))return e+i;if(r||(r=s*(.3*1.5)),(n=n||0)<Math.abs(i)){n=i;var a=r/4}else a=r/(2*Math.PI)*Math.asin(i/n);return t<1?n*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/r)*-.5+e:n*Math.pow(2,-10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/r)*.5+i+e},"ease-in-back":function(t,e,s,n,r){return r==i&&(r=1.70158),s*(t/=n)*t*((r+1)*t-r)+e},"ease-out-back":function(t,e,s,n,r){return r==i&&(r=1.70158),s*((t=t/n-1)*t*((r+1)*t+r)+1)+e},"ease-in-out-back":function(t,e,s,n,r){return r==i&&(r=1.70158),(t/=n/2)<1?s/2*(t*t*((1+(r*=1.525))*t-r))+e:s/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},"ease-in-bounce":function(t,e,i,s){return i-this["ease-out-bounce"](s-t,0,i,s)+e},"ease-out-bounce":function(t,e,i,s){return(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},"ease-in-out-bounce":function(t,e,i,s){return t<s/2?.5*this["ease-in-bounce"](2*t,0,i,s)+e:.5*this["ease-out-bounce"](2*t-s,0,i,s)+.5*i+e},cubicBezier:function(t,e,i,s,n){var r,a=1-3*i+3*t-0,o=3*i-6*t+0,h=3*t-0,c=1-3*s+3*e-0,l=3*s-6*e+0,u=3*e-0,d=n;for(r=0;r<5;r++)d=(d-=1/(3*a*d*d+2*o*d+h)*(a*d*d*d+o*d*d+h*d+0-n))>1?1:d<0?0:d;return Math.abs(c*d*d*d+l*d*d+u*d*0)}}};return t});var n=function(){var t=function(t,e,i,s,n){var r=n.style.getStroke(t.stroke);r[e]=i,t.stroke=n.style.getStroke(r,"string")};return{id:0,shapeType:"rectangular",type:"",origin:{x:0,y:0},events:{},children:[],added:!1,opacity:1,rotation:0,composition:"source-over",scalingX:1,scalingY:1,pointerEvents:!0,animationQueues:{},_:{x:0,y:0,abs_x:0,abs_y:0,rotation:0,width:0,height:0,drawn:!1,stroke:"",strokeColor:"",strokeWidth:0,strokePosition:"center",cap:"butt",join:"miter",miterLimit:10,fill:"",shadow:{offsetX:0,offsetY:0,blur:0,color:"transparent"}},set strokeColor(e){t(this,"color",e,0,this.core)},set strokeWidth(e){t(this,"width",e,0,this.core)},set strokePosition(e){t(this,"pos",e,0,this.core)},set stroke(t){"string"!=typeof t&&(t=this.core.style.getStroke(t,"string"));var e=this.core.style.getStroke(t);if(~e.color.indexOf("image(")){var i=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(e.color),s=i[1],n=i[4]||"repeat",r=new Image,a=this;r.src=s,this._.strokepattern_loading=!0,this._.strokepattern_redraw=!1,r.onload=function(){a._.strokeColor=a.core.canvas.createPattern(this,n),a._.strokepattern_loading=!1,a._.strokepattern_redraw&&(a._.strokepattern_redraw=!1,a.redraw())}}else this._.strokeColor=e.color;this._.strokeWidth=e.width,this._.strokePosition=e.pos,this._.stroke=t},set cap(t){this._.cap=~["butt","round","square"].indexOf(t)?t:"butt"},set join(t){this._.join=~["round","bevel","miter"].indexOf(t)?t:"miter"},set miterLimit(t){this._.miterLimit=isNaN(parseFloat(t))?10:parseFloat(t)},get stroke(){return this._.stroke},get strokeColor(){if(this._.strokepattern_loading)return this._.strokepattern_redraw=!0,"";if(~this._.strokeColor.toString().indexOf("CanvasPattern"))return this._.strokeColor;if(!~this._.strokeColor.indexOf("gradient"))return this._.strokeColor;var t=this.getOrigin();if("rectangular"===this.shapeType){var e="outside"===this.strokePosition?this.strokeWidth:"center"===this.strokePosition?this.strokeWidth/2:0;return this.core.style.getGradient(this._.strokeColor,this.abs_x-t.x-e,this.abs_y-t.y-e,this.width+2*e,this.height+2*e)}if("radial"===this.shapeType){var i=this.radius+this.strokeWidth/2;return t.x+=this.radius,t.y+=this.radius,this.core.style.getGradient(this._.strokeColor,this.abs_x-t.x-this.radius,this.abs_y-t.y-this.radius,2*i,2*i)}},get strokeWidth(){return this._.strokeWidth},get strokePosition(){return this._.strokePosition},get cap(){return this._.cap},get join(){return this._.join},get miterLimit(){return this._.miterLimit},set fill(t){if(~t.indexOf("image(")){var e=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(t),i=e[1],s=e[4]||"repeat",n=new Image,r=this;n.src=i,this._.pattern_loading=!0,this._.pattern_redraw=!1,n.onload=function(){r._.fill=r.core.canvas.createPattern(this,s),r._.pattern_loading=!1,r._.pattern_redraw&&(r._.pattern_redraw=!1,r.redraw())}}else this._.fill=t},get fill(){if(this._.pattern_loading)return this._.pattern_redraw=!0,"";if(~this._.fill.toString().indexOf("CanvasPattern"))return this._.fill;if(!~this._.fill.indexOf("gradient"))return this._.fill;var t=this.getOrigin();return"rectangular"===this.shapeType?this.core.style.getGradient(this._.fill,this.abs_x-t.x,this.abs_y-t.y,this.width,this.height):"radial"===this.shapeType?this.core.style.getGradient(this._.fill,this.abs_x-t.x-this.radius,this.abs_y-t.y-this.radius,2*this.radius,2*this.radius):void 0},set shadow(t){"string"!=typeof t&&(t=this.core.style.getShadow(t,"string"));var e=this.core.style.getShadow(t);this._.shadow=e},set shadowOffsetX(t){isNaN(parseFloat(t))||(this._.shadow.offsetX=parseFloat(t))},set shadowOffsetY(t){isNaN(parseFloat(t))||(this._.shadow.offsetY=parseFloat(t))},set shadowBlur(t){isNaN(parseFloat(t))||(this._.shadow.blur=parseFloat(t))},set shadowColor(t){this.core.style.isColor(t)&&(this._.shadow.color=t)},get shadow(){return this._.shadow},get shadowOffsetX(){return this._.shadow.offsetX},get shadowOffsetY(){return this._.shadow.offsetY},get shadowBlur(){return this._.shadow.blur},get shadowColor(){return this._.shadow.color},set x(t){this._.x=t,this._.abs_x=t+(this.parent!==i&&this.parent!==this.core?this.parent.abs_x:0);var e,s=this.children,n=s.length;for(e=0;e<n;e++)s[e]._.abs_x=this.abs_x+s[e].x,s[e].x+=0},set y(t){this._.y=t,this._.abs_y=t+(this.parent!==i&&this.parent!==this.core?this.parent.abs_y:0);var e,s=this.children,n=s.length;for(e=0;e<n;e++)s[e]._.abs_y=this.abs_y-s[e].y,s[e].y+=0},get x(){return this._.x},get y(){return this._.y},set abs_x(t){},set abs_y(t){},get abs_x(){return this._.abs_x},get abs_y(){return this._.abs_y},set width(t){this._.width=t},get width(){return this._.width},set height(t){this._.height=t},get height(){return this._.height},set zIndex(t){this.parent&&("front"===t&&(t=this.parent.children.length-1),"back"===t&&(t=0),this.core.draw.changeZorder(this.parent,this.zIndex,t))},get zIndex(){return this.parent&&this.parent.children.indexOf(this)},get drawn(){return!this.core.draw.isCleared&&this._.drawn},set drawn(t){this._.drawn=!!t},bind:function(t,e){return this.core.events.bind(this,t.split(" "),e),this},unbind:function(t,e){return this.core.events.unbind(this,t.split(" "),e),this},trigger:function(t,e){var i=this.core.events,s=i.getParentChain(this,!0,!0);return i.triggerChain(s,t.split(" "),i.fixEventObject(e)),this},add:function(t){return this.added||(t=t===i||t,this.core.children.push(this),this.added=!0,this.parent=this.core,this.core.draw.objects.push(this),t&&this.core.draw.redraw()),this},remove:function(t){if(t=t===i||t,!this.parent)return this;var e=this.parent.children.indexOf(this);if(~e){this.parent.children.splice(e,1),this.parent=i,this.added=!1,this.drawn=!1;var s=this.core.draw.objects.indexOf(this);~s&&this.core.draw.objects.splice(r,1);for(var n=this.children,r=0,a=n.length;r<a;r++)n[r].drawn=!1,~(s=this.core.draw.objects.indexOf(n[r]))&&this.core.draw.objects.splice(s,1);t&&this.core.draw.redraw()}return this},draw:function(){},redraw:function(){return this.core.draw.redraw(),this},rotate:function(t){return this.rotation+=t,this},rotateTo:function(t){return this.rotation=t,this},getArgs:function(t,e,s,n){if(s=s||0,n=n||0,"string"==typeof e){var r=t;t="x"===e?r:s,e="y"===e?r:n}else e===i&&(e=t);return{x:t,y:e}},move:function(t,e){var i=this.getArgs(t,e);return this.x+=i.x,this.y+=i.y,this},moveTo:function(t,e){var i=this.getArgs(t,e,this.x,this.y);return this.x=i.x,this.y=i.y,this},scale:function(t,e){var i=this.getArgs(t,e,1,1);return this.scalingX=i.x,this.scalingY=i.y,this},scaleTo:function(t,e){var i="rectangular"===this.shapeType?this.width:this.radius,s="rectangular"===this.shapeType?this.height:this.radius,n=this.getArgs(t,e,i,s);return n.x=n.x<=0?1:n.x,n.y=n.y<=0?1:n.y,this.scalingX=n.x/i,this.scalingX=n.y/s,this},animate:function(){return this.core.animation.animate(this,arguments),this},stop:function(){return this.core.animation.stop(this),this},finish:function(){return this.core.animation.finish(this),this},delay:function(t,e){return this.core.animation.delay(this,t,e),this},fadeIn:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:1}].concat(t)),this},fadeOut:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:0}].concat(t)),this},fadeTo:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:t.splice(0,1)[0]}].concat(t)),this},dragAndDrop:function(t){if(!1===(t=t===i?{}:t)&&!0===this.draggable)this.draggable=!1,this.unbind("mousedown touchstart",this._.drag_start),this.core.unbind("mouseup touchend",this._.drag_end),this.core.unbind("mousemove touchmove",this._.drag_move);else if(!this.draggable){this.draggable=!0,this.dragging=!1;var e=this,s={x:0,y:0},n={x:0,y:0},r={x:0,y:0};this._.drag_start=function(i){!1===t.bubble&&i.stopPropagation(),this.dragging=!0,s.x=i.x-this.x,s.y=i.y-this.y,n.x=this.x,n.y=this.y,r=e.core.tools.transformPointerPosition(e,e.abs_x,e.abs_y,e.rotation),!0===t.changeZindex&&(this.zIndex="front"),"function"==typeof t.start&&t.start.call(this),this.core.timeline.running||this.core.draw.redraw()},this._.drag_end=function(i){e.dragging&&(!1===t.bubble&&i.stopPropagation(),e.dragging=!1,"function"==typeof t.end&&t.end.call(e),e.core.timeline.running||e.core.draw.redraw())},this._.drag_move=function(i){if(e.dragging){!1===t.bubble&&i.stopPropagation();var s=e.core.tools.transformPointerPosition(e,e.abs_x,e.abs_y,e.rotation);e.x=n.x+s.x-r.x,e.y=n.y+s.y-r.y,"function"==typeof t.move&&t.move.call(e),e.core.timeline.running||e.core.draw.redraw()}},this.bind("mousedown touchstart",this._.drag_start),this.core.bind("mouseup touchend",this._.drag_end),this.core.bind("mousemove touchmove",this._.drag_move)}return this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},getOrigin:function(){var t=this.origin,e=this.shapeType;return{x:"center"===t.x?"rectangular"===e?this.width/2:0:"right"===t.x?"rectangular"===e?this.width:this.radius:"left"===t.x?"rectangular"===e?0:-this.radius:isNaN(parseFloat(t.x))?0:parseFloat(t.x),y:"center"===t.y?"rectangular"===e?this.height/2:0:"bottom"===t.y?"rectangular"===e?this.height:this.radius:"top"===t.y?"rectangular"===e?0:-this.radius:isNaN(parseFloat(t.y))?0:parseFloat(t.y)}},addChild:function(t,e){if(t.parent===i){var s=this.children.push(t)-1;if(t.parent=this,t.x+=0,t.y+=0,this.core.draw.objects.push(t),this.drawn&&this.core.draw.redraw(),e)return s}else if(e)return!1;return this},removeChild:function(t,e){var i=this.children.indexOf(t);return~i&&this.removeChildAt(i,e),this},removeChildAt:function(t,e){return this.children[t]!==i&&this.children[t].remove(e),this},clone:function(t){(t=t||{}).drawn=!1;var e,n,r,a,o,h,c,l,u,d=this.parent,f=this.core.display[this.type](t),g={},p=["core","events","children","parent","img","image","fill","strokeColor","added"],y=["abs_x","start_x","end_x"],_=["abs_y","start_y","end_y"];if((e=function(t,s){for(n in t)if(!~p.indexOf(n)&&(u=Object.getPropertyDescriptor(t,n))&&u.get===i){if("object"==typeof t[n]){s[n]=t[n].constructor===Array?[]:{},e(t[n],s[n]);continue}var r=t[n];d&&(y.indexOf(n)>-1?r-=d.abs_x:_.indexOf(n)>-1&&(r-=d.abs_y)),s[n]=r}})(this,g),g.fill=this._.fill,r=this.core.style.getStroke(this.stroke),g.strokeColor=r.color,this.image&&(g.image=this.image),(f=s.extend(f,g,t)).id=++this.core.lastObjectID,"function"==typeof f.init&&f.init(),(o=this.children).length>0)for(a=0;a<o.length;a++)h=o[a].clone(),f.children.push(h),h.parent=f,t.x&&(c=Math.abs(o[a].abs_x-this.x),h.x=c),t.y&&(l=Math.abs(o[a].abs_y-this.y),h.y=l);return f},isPointerInside:function(t){return this.core.tools.isPointerInside(this,t)}}};s.registerModule("displayObject",n),s.registerModule("display",{wrapper:!0,register:function(t,e,r,a){var o=this,h=this.core;return this[t]=function(c){var l=s.extend(Object.create(n()),new function(i,n){return s.extend({core:n,type:t,shapeType:"rectangular",draw:function(){return r.call(this,h.canvas,h),this}},e,i)}(c,h));return a!==i&&"function"==typeof o[t][a]&&o[t][a](),l},o}}),s.registerDisplayObject=function(t,e,r){s.registerModule("display."+t,{setCore:function(a){return function(o){var h=s.extend(Object.create(n()),new e(o,a));return h.type=t,h.id=++a.lastObjectID,a.animation.queues.create(h,"default"),r!==i&&h[r](),h}}})};s.registerDisplayObject("rectangle",function(t,e){return s.extend({core:e,shapeType:"rectangular",clipChildren:!1,draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;return t.beginPath(),t.rect(i,s,this.width,this.height),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,"outside"===this.strokePosition?t.strokeRect(i-this.strokeWidth/2,s-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth):"center"===this.strokePosition?t.strokeRect(i,s,this.width,this.height):"inside"===this.strokePosition&&t.strokeRect(i+this.strokeWidth/2,s+this.strokeWidth/2,this.width-this.strokeWidth,this.height-this.strokeWidth)),t.closePath(),this.clipChildren&&t.clip(),this}},t)});s.registerDisplayObject("image",function(t,e){return s.extend({core:e,_:s.extend({},e.displayObject._,{hasBeenDrawn:!1}),shapeType:"rectangular",loaded:!1,firstDrawn:!1,tile:!1,tile_width:0,tile_height:0,tile_spacing_x:0,tile_spacing_y:0,clipChildren:!1,init:function(){var t=this;if(this.image!==i){var e=this.image.nodeName&&"img"===this.image.nodeName.toLowerCase();this.img=e?this.image:new Image;var s=function(){t.loaded=!0,0!==t.width?0===t.height&&(t.height=t.width/(this.width/this.height)):t.width=this.width,0!==t.height?0===t.width&&(t.width=t.height/(this.height/this.width)):t.height=this.height,t.tile_width=0===t.tile_width?t.width:t.tile_width,t.tile_height=0===t.tile_height?t.height:t.tile_height,t._.hasBeenDrawn&&t.core.redraw()};e&&this.img.complete?s.call(this.img):(this.img.addEventListener("load",s),e||(this.img.src=this.image)),this.img.complete&&(-1!=this.img.src.indexOf(".svg")&&(this.img.width+=1,this.img.height+=1),this.width=this.img.width,this.height=this.img.height)}},draw:function(){var t,e,s=this.core.canvas,n=this,r=this.getOrigin(),a=this.abs_x-r.x,o=this.abs_y-r.y;if(this.loaded&&this.core.draw.objects[this.zIndex]!==i&&this.img.width>0&&this.img.height>0){if(t=0===this.width?this.img.width:this.width,e=0===this.height?this.img.height:this.height,this.tile){var h,c,l=Math.ceil(t/this.tile_width),u=Math.ceil(e/this.tile_height);for(s.save(),s.beginPath(),s.moveTo(a,o),s.lineTo(a+t,o),s.lineTo(a+t,o+e),s.lineTo(a,o+e),s.lineTo(a,o),s.clip(),c=0;c<u;c++)for(h=0;h<l;h++)s.drawImage(this.img,a+h*(this.tile_width+this.tile_spacing_x),o+c*(this.tile_height+this.tile_spacing_y),this.tile_width,this.tile_height);s.closePath(),s.restore()}else s.drawImage(this.img,a,o,t,e);this.strokeWidth>0&&(s.lineWidth=this.strokeWidth,s.strokeStyle=this.strokeColor,s.strokeRect(a,o,t,e)),!1===this.firstDrawn&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){n.draw()},100);return this.clipChildren&&(s.beginPath(),s.rect(a,o,t,e),s.closePath(),s.clip()),this._.hasBeenDrawn=!0,this}},t)},"init");var r=[];s.registerDisplayObject("text",function(t,i){var n=function(t,e,i,s,n){var r=n.style.getFont(t.font);r[e]=i,t._.font=n.style.getFont(r,"string"),"lineHeight"===s?(t._.lineHeight=isNaN(parseInt(i,10))?1:parseInt(i,10),t._.lineHeightUnit="string"==typeof i&&i.indexOf("px")>-1?"px":"relative"):t._[s]=i};return s.extend({core:i,shapeType:"rectangular",align:"start",baseline:"top",_:s.extend({},i.displayObject._,{hasBeenDrawn:!1,font:"normal normal normal 16px/1 sans-serif",style:"normal",variant:"normal",weight:"normal",size:16,lineHeight:1,family:"sans-serif",text:"",width:0,height:0,lines:[]}),set font(t){"string"!=typeof t&&(t=this.core.style.getFont(t,"string"));var e=this.core.style.getFont(t);t=this.core.style.getFont(e,"string"),this._.style=e.style,this._.variant=e.variant,this._.weight=e.weight,this._.size=e.size,this._.lineHeight=e.lineHeight,this._.lineHeightUnit=e.lineHeightUnit,this._.family=e.family,this._.font=t,this.initWebFont(),this.setDimensions()},set style(t){n(this,"style",t,"style",this.core),this.initWebFont(),this.setDimensions()},set variant(t){n(this,"variant",t,"variant",this.core),this.initWebFont(),this.setDimensions()},set weight(t){n(this,"weight",t,"weight",this.core),this.initWebFont(),this.setDimensions()},set size(t){n(this,"size",t,"size",this.core),this.setDimensions()},set lineHeight(t){n(this,"lineHeight",t,"lineHeight",this.core),this.setDimensions()},set family(t){n(this,"family",t,"family",this.core),this.initWebFont(),this.setDimensions()},set text(t){this._.text=t,this.setDimensions()},set width(t){},set height(t){},get font(){return this._.font},get style(){return this._.style},get variant(){return this._.variant},get weight(){return this._.weight},get size(){return this._.size},get lineHeight(){return this._.lineHeight+("px"===this._.lineHeightUnit?"px":0)},get family(){return this._.family},get text(){return this._.text},get width(){return this._.width},get height(){return this._.height},init:function(){this._.initialized=!0,this.initWebFont(),this.setDimensions()},setDimensions:function(){if(this._.initialized){var t,e,i,s,n,r,a,o,h;for((t=this.core.canvas).fillStyle=this.fill,t.font=this.font,i=(e=this.text.toString().split("\n")).length,n=0,r=0,h=[],a=0;a<i;a++)n=(o=t.measureText(e[a])).width>n?o.width:n,r+=s="px"===this._.lineHeightUnit?this._.lineHeight:this.size*this._.lineHeight,h.push({text:e[a],width:o.width,height:s});this._.width=n,this._.height=r,this._.lines=h}},initWebFont:function(){var t=this.style+" "+this.variant+" "+this.weight+" 0px "+this.family;if(!(r.indexOf(t)>-1)){r.push(t);var i,s=this,n=this.core;(i=e.createElement("span")).style.font=t,e.body.appendChild(i),setTimeout(function(){e.body.removeChild(i),s._.hasBeenDrawn&&n.redraw()},1e3)}},getAlignOffset:function(){return{start:"rtl"===this.core.canvasElement.dir?-this.width:0,end:"rtl"===this.core.canvasElement.dir?0:-this.width,left:0,center:-this.width/2,right:-this.width}[this.align]||0},getBaselineOffset:function(){return{top:.82*this.size,hanging:.65*this.size,middle:.31*this.size,alphabetic:0,ideographic:-.05*this.size,bottom:-.22*this.size}[this.baseline]||0},draw:function(){var t,e,i,s,n,r,a,o,h,c,l;if(t=this.core.canvas,e=this._.lines,i=this.getAlignOffset(),s=this.getBaselineOffset(),n="px"===this._.lineHeightUnit?this._.lineHeight/this.size:this._.lineHeight,r="top"!==this.baseline?this.size*(n-1)/2:0,a=this.getOrigin(),o=this.abs_x-a.x-i,h=this.abs_y-a.y+s-r,t.beginPath(),t.font=this.font,t.textAlign=this.align,t.textBaseline="alphabetic",this.strokeWidth>0)for(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,c=0,l=e.length;c<l;c++)t.strokeText(e[c].text,o,h+c*e[c].height+(e[c].height-this.size)/2);if(""!==this.fill)for(t.fillStyle=this.fill,c=0,l=e.length;c<l;c++)t.fillText(e[c].text,o,h+c*e[c].height+(e[c].height-this.size)/2);return t.closePath(),this._.hasBeenDrawn=!0,this}},t)},"init");s.registerDisplayObject("arc",function(t,e){return s.extend({core:e,shapeType:"radial",radius:0,start:0,end:0,direction:"clockwise",pieSection:!1,clipChildren:!1,draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;return t.beginPath(),this.radius>0&&this.start!==this.end&&(this.pieSection&&t.moveTo(i,s),t.arc(i,s,this.radius,this.start*Math.PI/180,this.end*Math.PI/180,"anticlockwise"===this.direction),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke())),t.closePath(),this.clipChildren&&t.clip(),this}},t)});s.registerDisplayObject("ellipse",function(t,e){return s.extend({core:e,shapeType:"radial",clipChildren:!1,_:s.extend({},e.displayObject._,{radius_x:0,radius_y:0}),set radius(t){this._.radius_x=t,this._.radius_y=t},set radius_x(t){this._.radius_x=t},set radius_y(t){this._.radius_y=t},get radius(){return this._.radius_x},get radius_x(){return this._.radius_x},get radius_y(){return this._.radius_y},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;if(t.beginPath(),this.radius_x===this.radius_y)t.arc(i,s,this.radius_x,0,2*Math.PI,!1);else{var n=.276142374915397,r=2*this.radius_x*n,a=2*this.radius_y*n;t.moveTo(i-this.radius_x,s),t.bezierCurveTo(i-this.radius_x,s-a,i-r,s-this.radius_y,i,s-this.radius_y),t.bezierCurveTo(i+r,s-this.radius_y,i+this.radius_x,s-a,i+this.radius_x,s),t.bezierCurveTo(i+this.radius_x,s+a,i+r,s+this.radius_y,i,s+this.radius_y),t.bezierCurveTo(i-r,s+this.radius_y,i-this.radius_x,s+a,i-this.radius_x,s)}return""!==this.fill&&(t.fillStyle=this.fill,t.fill()),this.strokeWidth>0&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke()),t.closePath(),this.clipChildren&&t.clip(),this}},t)});s.registerDisplayObject("polygon",function(t,e){return s.extend({core:e,shapeType:"radial",sides:3,clipChildren:!1,_:s.extend({},e.displayObject._,{radius:0,side:0}),set radius(t){this._.radius=t,this._.side=2*this._.radius*Math.sin(Math.PI/this.sides)},set side(t){this._.side=t,this._.radius=this._.side/2/Math.sin(Math.PI/this.sides)},get radius(){return this._.radius},get side(){return this._.side},draw:function(){var t,e,i,s=this.core.canvas,n=this.getOrigin(),r=this.abs_x-n.x,a=this.abs_y-n.y,o={x:0,y:0},h=this.sides,c=this.radius;for(s.beginPath(),i=0;i<=h;i++)t=r+c*Math.cos(2*i*Math.PI/h),e=a+c*Math.sin(2*i*Math.PI/h),0===i?(s.moveTo(t,e),o={x:t,y:e}):i==h?s.lineTo(o.x,o.y):s.lineTo(t,e);return s.closePath(),""!==this.fill&&(s.fillStyle=this.fill,s.fill()),this.strokeWidth>0&&(s.lineWidth=this.strokeWidth,s.strokeStyle=this.strokeColor,s.stroke()),this.clipChildren&&s.clip(),this}},t)});s.registerDisplayObject("line",function(t,e){return s.extend({core:e,shapeType:"radial",_:s.extend({},e.displayObject._,{start_x:0,start_y:0,end_x:0,end_y:0,x:0,y:0,abs_x:0,abs_y:0}),children:[],set start(t){this._.start_x=t.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.start_y=t.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},set end(t){this._.end_x=t.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.end_y=t.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},get start(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y);var e=this;return{get x(){return e._.start_x-t.x},get y(){return e._.start_y-t.y},set x(t){e._.start_x=t+(e.parent&&!e.parent.isCore?e.parent._.abs_x:0),e.setPosition()},set y(t){e._.start_y=t+(e.parent&&!e.parent.isCore?e.parent._.abs_y:0),e.setPosition()}}},get end(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y);var e=this;return{get x(){return e._.end_x-t.x},get y(){return e._.end_y-t.y},set x(t){e._.end_x=t+(e.parent&&!e.parent.isCore?e.parent._.abs_x:0),e.setPosition()},set y(t){e._.end_y=t+(e.parent&&!e.parent.isCore?e.parent._.abs_y:0),e.setPosition()}}},set x(t){var e,i,s,n,r;for(e=this._.end_x-this._.start_x,i=this.parent&&!this.parent.isCore?this.parent._.abs_x:0,this._.x=t,this._.abs_x=t+i,this._.start_x=t-e/2+i,this._.end_x=t+e/2+i,n=(s=this.children).length,r=0;r<n;r++)s[r]._.abs_x=this.abs_x+s[r].x,s[r].x+=0},set y(t){var e,i,s,n,r;for(e=this._.end_y-this._.start_y,i=this.parent&&!this.parent.isCore?this.parent._.abs_y:0,this._.y=t,this._.abs_y=t+i,this._.start_y=t-e/2+i,this._.end_y=t+e/2+i,n=(s=this.children).length,r=0;r<n;r++)s[r]._.abs_y=this.abs_y-s[r].y,s[r].y+=0},get x(){return this._.x},get y(){return this._.y},set length(t){var e,i,s,n;e=Math.abs(this._.end_x-this._.start_x),i=Math.abs(this._.end_y-this._.start_y),s=Math.sqrt(e*e+i*i),n=Math.asin(e/s),e=Math.sin(n)*t,i=Math.cos(n)*t,this._.end_x=this._.start_x+e,this._.end_y=this._.start_y+i,this.x+=0,this.y+=0,this.setPosition()},get length(){var t,e;return t=Math.abs(this._.end_x-this._.start_x),e=Math.abs(this._.end_y-this._.start_y),Math.sqrt(t*t+e*e)},set radius(t){this.length=2*t},get radius(){return this.length/2},setPosition:function(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y),this.x=this._.start_x-t.x+(this._.end_x-this._.start_x)/2,this.y=this._.start_y-t.y+(this._.end_y-this._.start_y)/2},init:function(){this.initialized=!0,this.setPosition()},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.core.draw.translation;return t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.beginPath(),t.moveTo(this._.start_x-i.x-e.x,this._.start_y-i.y-e.y),t.lineTo(this._.end_x-i.x-e.x,this._.end_y-i.y-e.y),t.stroke(),t.closePath(),this}},t)},"init");s.registerDisplayObject("sprite",function(t,e){return s.extend({core:e,shapeType:"rectangular",loaded:!1,firstDrawn:!1,frames:[],duration:0,frame:1,generate:!1,numFrames:0,offset_x:0,offset_y:0,direction:"x",running:!1,active:!1,loop:!0,clipChildren:!1,_:s.extend({},e.displayObject._,{autostart:!1,hasBeenDrawn:!1}),set autostart(t){this.active=t,this._.autostart=t},get autostart(){return this._.autostart},init:function(){if(this.image!==i){var t=this,e=this.image.nodeName&&"img"===this.image.nodeName.toLowerCase();this.img=e?this.image:new Image;var s=function(){var e,i,s,n,r;if(t.full_width=this.width,t.full_height=this.height,t.generate)for(i="y"===(e=t.direction)?t.full_height:t.full_width,s="y"===e?t.height:t.width,t.numFrames>0?n=t.numFrames:(n=i/s,t.numFrames=n),t.frames=[],r=0;r<n;r++)t.frames.push({x:t.offset_x+r*("x"===e?t.width:0),y:t.offset_y+r*("y"===e?t.height:0),d:t.duration});t.loaded=!0,t._.hasBeenDrawn&&t.core.redraw()};e&&this.img.complete?s.call(this.img):(this.img.addEventListener("load",s),e||(this.img.src=this.image))}},draw:function(){var t,e=this,s=this.core.canvas,n=this.getOrigin(),r=this.abs_x-n.x,a=this.abs_y-n.y,o=0,h=0;if(this.loaded){if(this.frames.length>0){if(this.frame>this.frames.length)return this.clipChildren&&(s.beginPath(),s.rect(r,a,0,0),s.closePath(),s.clip()),this;o=(t=this.frames[this.frame-1]).w!==i?t.w:this.width,h=t.h!==i?t.h:this.height,s.drawImage(this.img,t.x,t.y,o,h,r,a,o,h),this.strokeWidth>0&&(s.lineWidth=this.strokeWidth,s.strokeStyle=this.strokeColor,s.strokeRect(r,a,o,h)),!1===this.running&&this.active&&(setTimeout(function(){e.loop?e.frame=e.frame===e.frames.length?1:e.frame+1:e.frame=e.frame===e.frames.length?e.frame:e.frame+1,e.running=!1,e.core.timeline.running||e.core.draw.redraw()},t.d),this.running=!0)}!1===this.firstDrawn&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){e.draw()},100);return this.clipChildren&&(s.beginPath(),s.rect(r,a,o,h),s.closePath(),s.clip()),this._.hasBeenDrawn=!0,this},start:function(){return this.startAnimation(),this},startAnimation:function(){return this.active=!0,this.core.redraw(),this},stopAnimation:function(){return this.active=!1,this}},t)},"init")}(window,document),function(){"use strict";var t=Object.prototype,e=t.__defineGetter__,i=t.__defineSetter__,s=t.__lookupGetter__,n=t.__lookupSetter__,r=t.hasOwnProperty;e&&i&&s&&n&&(Object.defineProperty||(Object.defineProperty=function(t,a,o){if(arguments.length<3)throw new TypeError("Arguments not optional");if(a+="",r.call(o,"value")&&(s.call(t,a)||n.call(t,a)||(t[a]=o.value),r.call(o,"get")||r.call(o,"set")))throw new TypeError("Cannot specify an accessor and a value");return o.get&&e.call(t,a,o.get),o.set&&i.call(t,a,o.set),t}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(t,e){if(arguments.length<2)throw new TypeError("Arguments not optional.");e+="";var i={configurable:!0,enumerable:!0,writable:!0},a=s.call(t,e),o=n.call(t,e);return r.call(t,e)?a||o?(delete i.writable,i.get=i.set=void 0,a&&(i.get=a),o&&(i.set=o),i):(i.value=t[e],i):i}),Object.defineProperties||(Object.defineProperties=function(t,e){for(var i in e)r.call(e,i)&&Object.defineProperty(t,i,e[i])}))}();